
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://github.com/KienPC1234/fptoj_wiki/algo/data-structures/segment-tree-basic/">
      
      
        <link rel="prev" href="../rmq/">
      
      
        <link rel="next" href="../segment-tree-extend/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.7">
    
    
      
        <title>Cây Phân Đoạn (cơ bản) - FPTOJ WIKI</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.8608ea7d.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#cay-phan-oan-co-ban" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="FPTOJ WIKI" class="md-header__button md-logo" aria-label="FPTOJ WIKI" data-md-component="logo">
      
  <img src="../../../uploads/icon.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            FPTOJ WIKI
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Cây Phân Đoạn (cơ bản)
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="indigo"  aria-label="Chuyển sang chế độ tối"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Chuyển sang chế độ tối" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="indigo"  aria-label="Chuyển sang chế độ sáng"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Chuyển sang chế độ sáng" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="FPTOJ WIKI" class="md-nav__button md-logo" aria-label="FPTOJ WIKI" data-md-component="logo">
      
  <img src="../../../uploads/icon.svg" alt="logo">

    </a>
    FPTOJ WIKI
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Trang chủ
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../about/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Giới thiệu
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../markdown/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Test Markdown
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Thuật Toán
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Thuật Toán
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" >
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Cơ Bản
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            Cơ Bản
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../basic/backtracking/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Đệ quy và Thuật toán quay lui
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../basic/binary-search/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Thuật toán tìm kiếm nhị phân
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../basic/bitwise-operators/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Phép toán bit
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../basic/computational-complexity/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Độ phức tạp thời gian
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../basic/hoc-tin-the-nao-1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tôi đã học tin học như thế nào? Phần 1: vòng lặp
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../basic/hoc-tin-the-nao-2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tôi đã học tin học như thế nào? Phần 2: bắt đầu từ đâu
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../basic/meet-in-the-middle/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Meet In The Middle (MITM)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../basic/sorting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Thuật toán sắp xếp
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../basic/Tai-Lieu-Thuat-Toan/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Một số Tài liệu hay về Thuật Toán
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../basic/two-pointers.md78" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kĩ thuật hai con trỏ
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Đại Số
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Đại Số
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../algebra/binary_exponentation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lũy thừa nhị phân
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../algebra/euclid/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Thuật toán Euclid
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../algebra/fft-test/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Biến đổi Fourier nhanh - Fast Fourier transform
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../algebra/nCk/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cách tính số tổ hợp
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../algebra/primality_check/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kiểm tra số nguyên tố
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../algebra/prime_sieve/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sàng nguyên tố
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" checked>
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Cấu trúc dữ liệu
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            Cấu trúc dữ liệu
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../array-vs-linked-lists/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mảng và danh sách liên kết
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../C%C3%A2y-Palindrome/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cấu trúc của cây Palindrome
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../data-structures-overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tổng quan về Cấu Trúc Dữ Liệu
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../deque-min-max/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hàng đợi hai đầu (deque) và Bài toán tìm max-min trong đoạn tịnh tiến
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Deque/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Deque - hàng đợi hai đầu
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../disjoint-set-union/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Disjoint Set Union
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../disjoint-set/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Disjoints Sets
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fenwick-2d/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cây chỉ số nhị phân 2 chiều (BIT 2 chiều)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fenwick/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cây chỉ số nhị phân (Binary Indexed Tree)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hash-table/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bảng băm (Hash Table)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../heavy-light-decomposition/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Heavy-Light Decomposition (HLD)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../interval-tree-tap-doan-thang/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Interval Tree trên tập đoạn thẳng
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lca-binlift/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lowest Common Ancestor (LCA) - Binary Lifting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lca/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Các phương pháp giải bài toán LCA
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../mo-algorithm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chia căn (sqrt decomposition) và ứng dụng: Phần 2
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../overview-data-structures/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cấu trúc dữ liệu
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../persistent-data-structures/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Persistent Data Structures
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../prefix-sum-and-difference-array/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mảng cộng dồn và mảng hiệu
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../rmq/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Range Minimum Query (RMQ) - Sparse Table
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Cây Phân Đoạn (cơ bản)
    
  </span>
  

      </a>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../segment-tree-extend/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tất tần tật về Cây Phân Đoạn (Segment Tree)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Skip-Lists/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Skip Lists
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sqrt-decomposition/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chia căn (sqrt decomposition) và ứng dụng: Phần 1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Stack/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Stack (ngăn xếp)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../suffix-array/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mảng hậu tố (Suffix Array)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../suffix-automaton/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Suffix Automaton
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../trie/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Trie
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4" >
        
          
          <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Quy hoạch động
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            Quy hoạch động
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dp/basic-dynamic-programming-1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quy hoạch động cơ bản (Phần 1)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dp/basic-dynamic-programming-2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quy hoạch động cơ bản (Phần 2)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dp/basic-problems/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Một số bài toán quy hoạch động điển hình
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dp/Mot-so-ky-thuat-toi-uu-hoa-thuat-toan-Quy-Hoach-Dong/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Một số kĩ thuật tối ưu hoá thuật toán Quy Hoạch Động
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dp/palindrome-problems/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Một vài bài tập về Palindrome
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dp/thac-mac-ve-qhd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Phân tích về QHĐ - Thầy Lê Minh Hoàng
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_5" >
        
          
          <label class="md-nav__link" for="__nav_4_5" id="__nav_4_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Games
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5">
            <span class="md-nav__icon md-icon"></span>
            Games
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../games/Giai-Thuat-Cat-Tia-Alpha-beta/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Giải thuật cắt tỉa Alpha-beta
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_6" >
        
          
          <label class="md-nav__link" for="__nav_4_6" id="__nav_4_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Hình học
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6">
            <span class="md-nav__icon md-icon"></span>
            Hình học
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../geometry/basic-geometry-1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hình học tính toán phần 1: Những khái niệm cơ bản
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../geometry/basic-geometry-2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hình học tính toán phần 2: Sự giao nhau của đường thẳng và các ứng dụng
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../geometry/Sweep-Line/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Thuật toán đường quét
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_7" >
        
          
          <label class="md-nav__link" for="__nav_4_7" id="__nav_4_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Lý thuyết Đồ Thị
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_7">
            <span class="md-nav__icon md-icon"></span>
            Lý thuyết Đồ Thị
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../graph-theory/breadth-first-search/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    BFS (Breadth-first search)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../graph-theory/centroid-decomposition/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Thuật toán phân tách trọng tâm - Centroid decomposition
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../graph-theory/Depth-First-Search-Tree/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cây DFS (Depth-First Search Tree) và ứng dụng
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../graph-theory/euler-cycle/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Đường đi - Chu trình Euler
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../graph-theory/euler-tour-on-tree/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Đường đi Euler trên cây
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../graph-theory/everything/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Các chủ đề cơ bản về đồ thị
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../graph-theory/flow/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bài toán Luồng cực đại trên mạng
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../graph-theory/lubenica-vnoj/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bài toán LUBENICA
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../graph-theory/minimum-spanning-tree/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bài toán tìm cây khung nhỏ nhất trong đồ thị
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../graph-theory/shortest-path/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Các thuật toán về tìm đường đi ngắn nhất
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../graph-theory/topological-sort/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sắp xếp Tô-pô (Topological Sort)
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_8" >
        
          
          <label class="md-nav__link" for="__nav_4_8" id="__nav_4_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Toán
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_8">
            <span class="md-nav__icon md-icon"></span>
            Toán
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../math/game-theory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lý thuyết trò chơi
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../math/Ham-Mobius/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hàm Mobius
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../math/modular-inverse/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Số học 4.5 - Nghịch đảo modulo
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../math/multiplicative-function/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hàm nhân tính
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_9" >
        
          
          <label class="md-nav__link" for="__nav_4_9" id="__nav_4_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tìm Kiếm
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_9">
            <span class="md-nav__icon md-icon"></span>
            Tìm Kiếm
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../search/Local-Search/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Local Search
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_10" >
        
          
          <label class="md-nav__link" for="__nav_4_10" id="__nav_4_10_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Kỹ Năng Thi
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_10">
            <span class="md-nav__icon md-icon"></span>
            Kỹ Năng Thi
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../skill/Ki-nang-thi-cu/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tổng hợp các lời khuyên cho các kỳ thi
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../skill/Kinh-nghiem-thi-VOI/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kinh nghiệm thi VOI
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../skill/viet-trinh-cham/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tự code, tự chấm, tự sướng - Bí kíp thi offline
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_11" >
        
          
          <label class="md-nav__link" for="__nav_4_11" id="__nav_4_11_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Xâu kí tự
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_11">
            <span class="md-nav__icon md-icon"></span>
            Xâu kí tự
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../string/basic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Xử lý xâu
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../string/hash/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hash: A String Matching Algorithm
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../string/kmp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Thuật toán KMP
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../string/manacher/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Thuật toán Manacher
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../string/z-algo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Z-function
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_12" >
        
          
          <label class="md-nav__link" for="__nav_4_12" id="__nav_4_12_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Mẹo
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_12">
            <span class="md-nav__icon md-icon"></span>
            Mẹo
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Ph%E1%BB%8Fng-v%E1%BA%A5n-team-IOI-VN-2017/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Phỏng Vấn Team IOI VN 2017
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/vojsol/ALAKE/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ALAKE
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../trick/convex_greedy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sum-constrained convex optimization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../trick/counting-without-matrix-multiplication/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Khử nhân ma trận
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../trick/FFT/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FFT
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../trick/matrix-multiplication/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Nhân ma trận (Matrix multiplication)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../trick/mitm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Meet In The Middle (MITM)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../trick/Roi-rac-hoa-va-ung-dung/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Rời rạc hoá và ứng dụng
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Computer Science (Khoa học máy tính)
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Computer Science (Khoa học máy tính)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1" >
        
          
          <label class="md-nav__link" for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Crypto
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1">
            <span class="md-nav__icon md-icon"></span>
            Crypto
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cs/crypto/Cipher-Tools/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mật mã và Code
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cs/crypto/Public-Key-Cryptography/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Public Key Cryptography
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_3" >
        
          
          <label class="md-nav__link" for="__nav_5_1_3" id="__nav_5_1_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Cipher
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_3">
            <span class="md-nav__icon md-icon"></span>
            Cipher
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cs/crypto/cipher/ROT13/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ROT13
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Xử lý ảnh
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            Xử lý ảnh
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cs/imageprocessing/Seam-Carving/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Seam Carving Algorithm
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cs/imageprocessing/setup-opencv-windows/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hướng dẫn cài đặt OpenCV trên Windows
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Ngôn Ngữ Lập Trình
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Ngôn Ngữ Lập Trình
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../languages/cpp/pointers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Con trỏ trong C/C++
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../languages/cpp/string/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Xâu trong C++
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/Pascal-Vi-sao/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hoài niệm về Pascal - Lê Minh Hoàng
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Dịch Thuật
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Dịch Thuật
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../translate/functional-programming-part-1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Functional Programming - Phần 1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_2" >
        
          
          <label class="md-nav__link" for="__nav_7_2" id="__nav_7_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Codeforces
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_2">
            <span class="md-nav__icon md-icon"></span>
            Codeforces
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../translate/codeforces/Efficient-and-easy-segment-trees/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cài đặt cây phân đoạn hiệu quả (Efficient and easy segment trees)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../translate/codeforces/hash-table/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bảng băm (Hash Tables)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../translate/codeforces/palindrome-tree/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Palindrome tree
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../translate/codeforces/stack-queue/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Queue & Stack
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../translate/codeforces/z-algo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Z Algorithm
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_3" >
        
          
          <label class="md-nav__link" for="__nav_7_3" id="__nav_7_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    E-Maxx
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_3">
            <span class="md-nav__icon md-icon"></span>
            E-Maxx
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../translate/emaxx/Aho-Corasick/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Aho Corasick
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../translate/emaxx/Tim-kiem-tam-phan-Ternary-Search/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tìm kiếm tam phân - Ternary Search
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_4" >
        
          
          <label class="md-nav__link" for="__nav_7_4" id="__nav_7_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Nâng Cao
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_4">
            <span class="md-nav__icon md-icon"></span>
            Nâng Cao
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../translate/he/Lucas-theorem/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Định lý Lucas
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../translate/he/Number-Theory-2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Số học 2 - Số nguyên tố, Sàng Eratosthenes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../translate/he/Number-Theory-3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Số học 3 - Tính (a^b) % c
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../translate/he/Number-Theory-4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Số học 4 - Phi hàm Euler
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../translate/he/Number-Theory-5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Số học 5 - Các kiến thức cơ bản về Tổ hợp (Combinatorics)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../translate/he/Number-Theory-6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Số học 6 - Xác suất (Probabilities)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../translate/he/Number-Theory-7/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Số học 7 - Bao hàm - Loại trừ (Inclusion-Exclusion)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../translate/he/So-hoc-Phan-1-Modulo-gcd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Số học 1 - Modulo & gcd
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../translate/he/Wilsons-theorem/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Định lý Wilson
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_5" >
        
          
          <label class="md-nav__link" for="__nav_7_5" id="__nav_7_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Máy học (Machine Learning - ML)
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_5">
            <span class="md-nav__icon md-icon"></span>
            Máy học (Machine Learning - ML)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cs/ml/machine-learning-101/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Machine Learning 101 (1): Làm quen
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../translate/PyTorch-la-gi/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PyTorch Là Gì?
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../translate/ml/Machine-Learning-Classification-phan-1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Machine Learning - Classification - phần 1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../translate/ml/Machine-Learning-Classification-phan-2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Machine Learning - Classification - phần 2
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../translate/ml/Machine-Learning-Classification-phan-3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Machine Learning - Classification - phần 3
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_6" >
        
          
          <label class="md-nav__link" for="__nav_7_6" id="__nav_7_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Quora
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_6">
            <span class="md-nav__icon md-icon"></span>
            Quora
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../translate/quora/mobius-function/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hàm Mobius
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_7" >
        
          
          <label class="md-nav__link" for="__nav_7_7" id="__nav_7_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Topcoder
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_7">
            <span class="md-nav__icon md-icon"></span>
            Topcoder
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../translate/topcoder/Computational-Complexity-Section-1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Độ phức tạp tính toán
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../translate/topcoder/Computational-Complexity-Section-2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Độ phức tạp tính toán - phần 2
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../translate/topcoder/dynamic-programming/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Nhập môn Quy hoạch động
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../translate/topcoder/fun-with-bits/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fun with Bits
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../translate/topcoder/Greedy-is-Good/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Thuật toán Tham lam
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../translate/topcoder/Hieu-ve-xac-suat/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Xác suất
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../translate/topcoder/How-to-Dissect-a-Topcoder-Problem-Statement/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kĩ năng đọc đề Topcoder
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../translate/topcoder/How-to-Find-a-Solution/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Nghệ thuật giải bài
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../translate/topcoder/Mathematics-for-Topcoders/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Toán học trong Tin học
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../translate/topcoder/max-flow-1-luong-cuc-dai-tren-mang-1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Luồng cực đại trên mạng - Maxflow network
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../translate/topcoder/Planning-an-Approach-to-a-Topcoder-Problem-Part-1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Những cách tiếp cận bài toán: Phần 1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../translate/topcoder/Planning-an-Approach-to-a-Topcoder-Problem-Part-2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Những cách tiếp cận bài toán: Phần 2
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../translate/topcoder/Range-Minimum-Query-and-Lowest-Common-Ancestor/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bài toán RMQ và bài toán LCA
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../translate/topcoder/The-Importance-of-Algorithm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tầm Quan Trọng Của Thuật Toán
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../translate/topcoder/Using-Regular-Expression/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sử dụng Regex
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_8" >
        
          
          <label class="md-nav__link" for="__nav_7_8" id="__nav_7_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    USACO
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_8">
            <span class="md-nav__icon md-icon"></span>
            USACO
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../translate/USACO/Crafting-Winning-Solutions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Viết lời giải chiến thắng trong kì thi
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_9" >
        
          
          <label class="md-nav__link" for="__nav_7_9" id="__nav_7_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Wcipeg
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_9">
            <span class="md-nav__icon md-icon"></span>
            Wcipeg
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../translate/wcipeg/Bao-l%E1%BB%93i/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Giải thích trực quan về bao lồi trên mặt phẳng
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../translate/wcipeg/Binary-Heap/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Binary Heap
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../translate/wcipeg/Convex-Hull-Trick/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kĩ thuật bao lồi (Convex Hull Trick)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../translate/wcipeg/Convex-Hull/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bao lồi (Convex Hull)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../translate/wcipeg/Flows/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bài toán luồng cực đại
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../translate/wcipeg/kmp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Thuật toán Knuth-Morris-Pratt (KMP)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../translate/wcipeg/tree/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cây (Tree)
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="cay-phan-oan-co-ban">Cây Phân Đoạn (cơ bản)</h1>
<p><strong>Nguồn:</strong> <a href="http://wcipeg.com/wiki/Segment_tree">wcipeg</a>, <a href="https://cp-algorithms.com/data_structures/segment_tree.html">cp-algorithms</a>, <a href="algo/data-structures/segment-tree-extend">Tất tần tật về Cây Phân Đoạn (Segment Tree) - VNOI</a></p>
<p><strong>Tác giả:</strong> </p>
<ul>
<li>Nguyễn Châu Khanh - VNU University of Engineering and Technology (VNU-UET)</li>
</ul>
<p><strong>Reviewer:</strong> </p>
<ul>
<li>Trần Xuân Bách - HUS High School for Gifted Students</li>
<li>Nguyễn Nhật Minh Khôi - VNUHCM-University of Science</li>
<li>Nguyễn Phú Bình - Hung Vuong High School for the Gifted, Binh Duong Province</li>
<li>Ngô Nhật Quang - HUS High School for Gifted Students</li>
<li>Hồ Ngọc Vĩnh Phát - VNUHCM-University of Science</li>
</ul>
<p><strong>LƯU Ý:</strong> Mọi số thứ tự trong bài viết đều được đánh số bắt đầu từ <span class="arithmatex">\(1\)</span>. </p>
<h1 id="mo-au">Mở đầu</h1>
<p><strong>Cây phân đoạn</strong> <strong><em>(Segment Tree)</em></strong> là một cấu trúc dữ liệu rất linh hoạt được sử dụng nhiều trong các kỳ thi, đặc biệt là trong những bài toán xử lý trên dãy số.</p>
<p>Ở bài viết này, ta sẽ chỉ tìm hiểu về những kiến thức cơ bản của <strong>Segment Tree</strong> và một số bài tập thường gặp trong các kì thi.</p>
<p>Còn nếu bạn muốn tìm hiểu sâu hơn về <strong>Segment Tree</strong> thì bạn có thể tham khảo bài viết: <a href="algo/data-structures/segment-tree-extend">Tất tần tật về Cây Phân Đoạn (Segment Tree) - VNOI</a>.</p>
<h1 id="y-tuong">Ý tưởng</h1>
<p>Một trong những ứng dụng phổ biến nhất của <strong>Segment Tree</strong> là giải quyết bài toán <a href="translate/topcoder/Range-Minimum-Query-and-Lowest-Common-Ancestor"><span class="arithmatex">\(Range \space Minimum \space Query \space \mathit{(RMQ)}\)</span></a>. Trong bài toán này, ta được cho một mảng <span class="arithmatex">\(A\)</span> và <span class="arithmatex">\(Q\)</span> truy vấn; mỗi truy vấn gồm cặp số <span class="arithmatex">\(l\)</span> và <span class="arithmatex">\(r\)</span>, yêu cầu tìm phần tử có giá trị nhỏ nhất trong đoạn từ <span class="arithmatex">\(l\)</span> đến <span class="arithmatex">\(r\)</span> của mảng <span class="arithmatex">\(A\)</span>. 
- <strong>Ví dụ:</strong> Ta có mảng <span class="arithmatex">\(<span class="arithmatex">\(A = \{9,2,6,3,1,5,7\}\)</span>\)</span>. Với truy vấn <span class="arithmatex">\(l = 3\)</span> và <span class="arithmatex">\(r = 6\)</span>, đáp án sẽ là <span class="arithmatex">\(\min{(6,3,1,5)} = 1\)</span>. Sau đó, một truy vấn khác với <span class="arithmatex">\(l = 1\)</span> và <span class="arithmatex">\(r = 3\)</span> thì đáp án là <span class="arithmatex">\(2\)</span>; v.v...</p>
<p>Có nhiều giải pháp khác nhau để giải quyết bài toán này nhưng <strong>Segment Tree</strong> thường là lựa chọn thích hợp nhất, đặc biệt là khi có thêm <strong>hoạt động sửa đổi</strong> được xen kẽ với các truy vấn. </p>
<p><strong>Giải pháp chia để trị</strong></p>
<ul>
<li>
<p>Ta có giải pháp <a href="https://vi.wikipedia.org/wiki/Thu%E1%BA%ADt_to%C3%A1n_chia_%C4%91%E1%BB%83_tr%E1%BB%8B">chia để trị</a> sau:</p>
<ul>
<li>Nếu dãy đang xét chứa một phần tử, thì bản thân phần tử đó là giá trị nhỏ nhất trong dãy đó.</li>
<li>
<p>Nếu không, ta chia dãy đó thành hai dãy con liên tiếp nhỏ hơn, mỗi dãy con gần bằng một nửa kích thước của dãy ban đầu, và tìm giá trị nhỏ nhất tương ứng của chúng. Giá trị nhỏ nhất của dãy ban đầu chính là giá trị nhỏ hơn giữa hai giá trị nhỏ nhất của các dãy con.</p>
<ul>
<li>Ví dụ mô tả thuật toán chia để trị với mảng <span class="arithmatex">\(<span class="arithmatex">\(A = \{9,2,6,3,1,5,7\}\)</span>\)</span>:</li>
</ul>
<p><img alt="/fptoj_wiki/uploads/segment-tree-basic_img1.png" src="/fptoj_wiki/uploads/segment-tree-basic_img1.png" /></p>
</li>
</ul>
</li>
<li>
<p>Nhận thấy rằng, khi ta sửa đổi giá trị của một phần tử bất kỳ trong mảng thì số lượng đoạn cần tính lại không nhiều. Vậy nên ta sẽ lưu lại kết quả và chỉ tính lại khi thực sự cần thiết. </p>
<ul>
<li><strong>Ví dụ:</strong> Trong ví dụ bên trên, khi sửa đổi phần tử có giá trị <span class="arithmatex">\(1\)</span> thành giá trị <span class="arithmatex">\(8\)</span> thì ta chỉ cần tính lại giá trị nhỏ nhất của các đoạn <span class="arithmatex">\([1, 7]\)</span>, <span class="arithmatex">\([5, 7]\)</span>, <span class="arithmatex">\([5, 6]\)</span> và <span class="arithmatex">\([5, 5]\)</span>.</li>
</ul>
<p><img alt="/fptoj_wiki/uploads/segment-tree-basic_img2.png" src="/fptoj_wiki/uploads/segment-tree-basic_img2.png" /></p>
</li>
</ul>
<p><strong>Tổng quát</strong></p>
<ul>
<li>
<p>Gọi <span class="arithmatex">\(a_i\)</span> là giá trị của phần tử thứ <span class="arithmatex">\(i\)</span> trong mảng, việc tìm giá trị nhỏ nhất có thể được viết dưới dạng hàm <a href="https://vi.wikipedia.org/wiki/%C4%90%E1%BB%87_quy_(tin_h%E1%BB%8Dc)">đệ quy</a> như sau:
    <span class="arithmatex">\(<span class="arithmatex">\(f(l, r) = \begin{cases} 
                    a_l &amp; \quad \text{if } l = r \\ 
                    \min{\Big( f \big(l, \big\lfloor \frac{l + r}{2} \big\rfloor \big), f \big( \big\lfloor \frac{l + r}{2} \big\rfloor + 1, r \big) \Big)}  &amp; \quad \text{if } l &lt; r 
                \end{cases}\)</span>\)</span></p>
<ul>
<li>Với <span class="arithmatex">\(f(l, r)\)</span> là phần tử có giá trị nhỏ nhất trong đoạn từ <span class="arithmatex">\(l\)</span> đến <span class="arithmatex">\(r\)</span> của mảng <span class="arithmatex">\(A\)</span>.</li>
</ul>
</li>
<li>
<p>Do đó, khi ta sửa đổi giá trị của phần tử thứ <span class="arithmatex">\(i\)</span> trong mảng thì ta chỉ cần tính lại kết quả của các hàm <span class="arithmatex">\(f(l, r)\)</span> với <span class="arithmatex">\(l \le i \le r\)</span>.</p>
</li>
</ul>
<p>Giả sử rằng ta sử dụng hàm được định nghĩa ở trên để xác định <span class="arithmatex">\(f(1, N)\)</span>, với <span class="arithmatex">\(N\)</span> là số lượng phần tử của mảng. Khi <span class="arithmatex">\(N\)</span> lớn, hàm gọi đệ quy này sẽ có hai "con", một trong số đó là lệnh gọi đệ quy <span class="arithmatex">\(f \big(l, \big\lfloor \frac{l + r}{2} \big\rfloor \big)\)</span> và lệnh còn lại là <span class="arithmatex">\(f \big( \big\lfloor \frac{l + r}{2} \big\rfloor + 1, r \big)\)</span>. Mỗi hàm này sau đó sẽ lại có thêm hai "con" của riêng nó, và cứ tiếp tục như vậy cho đến khi đạt được trường hợp cơ sở (khi <span class="arithmatex">\(l = r\)</span>). </p>
<p>Nếu ta biểu diễn các hàm gọi đệ quy này bằng cấu trúc <a href="translate/wcipeg/tree">cây</a>, thì hàm <span class="arithmatex">\(f(1, N)\)</span> sẽ là gốc, nó sẽ có hai con, mỗi con sẽ có thêm hai con nữa, v.v...; các trường hợp cơ sở sẽ là lá của cây. Khi đó, cấu trúc cây gọi đệ quy của hàm <span class="arithmatex">\(f(1, N)\)</span> chính là cấu trúc của <strong>cây phân đoạn</strong>. Và việc sửa đổi giá trị phần tử trong mảng cũng chính là bản chất của <strong>thao tác cập nhật</strong> trên cây phân đoạn <em>(sẽ được mô tả rõ hơn ở phần sau)</em>.</p>
<ul>
<li><strong>Ví dụ:</strong> Ta có mảng <span class="arithmatex">\(<span class="arithmatex">\(A = \{9,2,6,3,1,5,7\}\)</span>\)</span> được kiểm soát bởi cây phân đoạn sau:</li>
</ul>
<p><img alt="/fptoj_wiki/uploads/segment-tree-basic_img3.png" src="/fptoj_wiki/uploads/segment-tree-basic_img3.png" /></p>
<h1 id="cau-truc">Cấu trúc</h1>
<p>Bây giờ ta đã sẵn sàng để xác định cấu trúc của cây phân đoạn:</p>
<ul>
<li><strong>Segment Tree</strong> là một <a href="translate/wcipeg/tree">cây</a>. Cụ thể hơn, nó là một cây nhị phân đầy đủ (mỗi nút là lá hoặc có đúng <span class="arithmatex">\(2\)</span> nút con).</li>
<li>Mỗi nút quản lý một dãy các đối tượng liên tiếp, trong nút chứa thông tin tổng hợp từ các đối tượng mà nó quản lý.</li>
<li>Với một dãy số gồm <span class="arithmatex">\(N\)</span> phần tử, nút gốc quản lý các đối tượng từ <span class="arithmatex">\(1\)</span> tới <span class="arithmatex">\(N\)</span>.</li>
<li>Nếu một nút quản lý dãy các đối tượng từ <span class="arithmatex">\(l\)</span> tới <span class="arithmatex">\(r\)</span> <span class="arithmatex">\((l&lt;r)\)</span> thì nút con trái của nó quản lý các đối tượng từ <span class="arithmatex">\(l\)</span> tới <span class="arithmatex">\(mid\)</span> và nút con phải của nó quản lý các đối tượng từ <span class="arithmatex">\(mid+1\)</span> tới <span class="arithmatex">\(r\)</span> <span class="arithmatex">\(\big(\)</span>Với <span class="arithmatex">\(mid = \big\lfloor \frac{l + r}{2} \big\rfloor \big)\)</span>.</li>
<li>Nếu một nút chỉ quản lý một đối tượng thì nó sẽ là nút lá và không có nút con. </li>
<li>Chiều cao của cây phân đoạn là <span class="arithmatex">\(\mathcal{O}(\log{N})\)</span>, bởi vì khi đi xuống từ gốc đến lá, kích thước của mỗi đoạn giảm đi một nửa.</li>
<li>Tại mỗi độ sâu của cây, không có phần tử nào được quản lý bởi <span class="arithmatex">\(2\)</span> nút khác nhau của cây.</li>
</ul>
<h1 id="cac-thao-tac-tren-cay-phan-oan">Các thao tác trên cây phân đoạn</h1>
<p>Có <span class="arithmatex">\(3\)</span> thao tác cơ bản trên cây phân đoạn:</p>
<h2 id="xay-dung">Xây dựng</h2>
<p>Để có thể có thể lấy giá trị và sửa đổi dãy số, trước tiên ta cần phải xây dựng một cây phân đoạn hợp lệ. </p>
<p>Trước khi xây dựng cây phân đoạn, ta cần quyết định:
1. Thông tin được lưu trữ tại mỗi nút của cây phân đoạn. <strong>Ví dụ:</strong> Trong cây phân đoạn lấy giá trị nhỏ nhất, một nút sẽ lưu trữ giá trị nhỏ nhất của các phần tử trong đoạn <span class="arithmatex">\([l, r]\)</span> mà nó quản lý.
2. Phép toán hợp nhất hai nút con trong một cây phân đoạn. <strong>Ví dụ:</strong> Trong cây phân đoạn lấy giá trị nhỏ nhất, hai nút con tương ứng với đoạn <span class="arithmatex">\([l1, r1]\)</span> và đoạn <span class="arithmatex">\([l2, r2]\)</span> sẽ được hợp nhất thành một nút tương ứng với đoạn <span class="arithmatex">\([l1, r2]\)</span> bằng cách lấy <em>min</em> các giá trị của hai nút con.</p>
<p><span class="arithmatex">\(\circ\)</span> Lưu ý rằng một đỉnh là "đỉnh lá", nếu đoạn tương ứng của nó chỉ bao gồm một giá trị trong mảng ban đầu. Nó là đỉnh thấp nhất của cây phân đoạn. Giá trị của nó sẽ bằng phần tử <span class="arithmatex">\(a_i\)</span> tương ứng.</p>
<p>Có <span class="arithmatex">\(2\)</span> cách để xây dựng một cây phân đoạn:
- <strong>Cách 1:</strong> Xây dựng <em>"từ dưới lên trên"</em>
    - Để xây dựng cây phân đoạn, ta sẽ bắt đầu ở các nút có độ sâu thấp nhất <em>(các nút lá)</em> và gán cho chúng các giá trị tương ứng. Rồi từ đó, ta có thể tính toán lên các nút cha bằng cách "hợp nhất" lần lượt <span class="arithmatex">\(2\)</span> nút con và lặp lại quy trình cho đến khi đạt đến đỉnh gốc.</p>
<ul>
<li><strong>Cách 2:</strong> Xây dựng <em>"từ trên xuống dưới"</em><ul>
<li>Cấu trúc từ trên xuống là sử dụng <a href="https://vi.wikipedia.org/wiki/%C4%90%E1%BB%87_quy_(tin_h%E1%BB%8Dc)">đệ quy</a>. Tức là ta sẽ bắt đầu từ đỉnh gốc đến các đỉnh lá bằng mô hình đệ quy như sau:<ol>
<li>Nếu nút đang xét là nút lá, ta có thể lấy được ngay giá trị tương ứng từ mảng. </li>
<li>Ngược lại, nếu nút đang xét không phải là nút lá, ta gọi đệ quy để tính toán giá trị của hai nút con. Sau khi hai lệnh gọi đệ quy được thực hiện, giá trị của nút đang xét sẽ bằng giá trị được "hợp nhất" từ hai nút con.</li>
</ol>
</li>
<li>Do thủ tục đệ quy bắt đầu từ đỉnh gốc nên ta có thể tính toán được toàn bộ cây phân đoạn.</li>
</ul>
</li>
</ul>
<h2 id="cap-nhat">Cập nhật</h2>
<p>Bây giờ ta muốn sửa đổi một phần tử cụ thể trong mảng, giả sử ta muốn thực hiện việc gán <span class="arithmatex">\(a_i = x\)</span>. Và phải cập nhật lại cây phân đoạn, sao cho nó tương ứng với mảng mới đã sửa đổi.</p>
<p>Để làm như vậy, trước tiên ta cần sửa đổi nút lá tương ứng. Các nút lá khác không bị ảnh hưởng, vì mỗi nút lá chỉ được liên kết với một phần tử trong mảng. Nút cha của nút đã sửa đổi cũng bị ảnh hưởng, vì đoạn nó quản lý cũng chứa phần tử đã sửa đổi, và các nút tổ tiên của nó cũng vậy, v.v... cho đến nút gốc. </p>
<p>Nói cách khác, tất cả các nút nằm trên đường đi đơn từ gốc đến nút lá tương ứng đều bị ảnh hưởng. Ngoài ra, <strong>không còn nút nào khác bị ảnh hưởng</strong>. Do đó, với một dãy số gồm <span class="arithmatex">\(N\)</span> phần tử thì chiều cao của cây phân đoạn tương ứng sẽ là <span class="arithmatex">\(\mathcal{O}(\log{N})\)</span> nên chỉ có <span class="arithmatex">\(\mathcal{O}(\log{N})\)</span> nút cần được cập nhật.
- <strong>Ví dụ:</strong> Cho mảng <span class="arithmatex">\(<span class="arithmatex">\(A = \{9,2,6,3,1,5,7\}\)</span>\)</span>. Phần tử có giá trị <span class="arithmatex">\(1\)</span> được thay đổi thành giá trị <span class="arithmatex">\(8\)</span> trong cây phân đoạn lấy giá trị nhỏ nhất.</p>
<p><a href="/fptoj_wiki/uploads/segment-tree-basic_gif1.gif">/fptoj_wiki/uploads/segment-tree-basic_gif1.gif</a></p>
<p>Thao tác cập nhật cây phân đoạn có thể được thực hiện bằng cách sử dụng một hàm đệ quy:
- Để thực hiện cập nhật từ trên xuống, ta bắt đầu từ nút gốc; điều này dẫn đến lệnh gọi đệ quy tới một nút con quản lí đoạn chứa phần tử cần sửa đổi (nút con còn lại và cây con của nó không bị ảnh hưởng); v.v... Cho đến trường hợp cơ sở là nút lá được liên kết với phần tử cần cập nhật, ta sửa lại giá trị của nút lá đó. 
- Sau khi hoàn tất lệnh gọi đệ quy cho các nút con <em>(trừ trường hợp cơ sở)</em>, giá trị của nút đang xét sẽ được cập nhật lại theo giá trị hai nút con của nó. </p>
<p>Tương tự như thao tác xây dựng cây phân đoạn, cách cập nhật cây phân đoạn "từ dưới lên" cũng có thể thực hiện được.</p>
<h2 id="lay-gia-tri">Lấy giá trị</h2>
<p>Bây giờ, ta cần phải trả lời các truy vấn lấy giá trị. Ví dụ như: cho hai số nguyên <span class="arithmatex">\(l\)</span> và <span class="arithmatex">\(r\)</span>, hãy xác định phần tử có giá trị nhỏ nhất trong đoạn <span class="arithmatex">\([l, r]\)</span> của mảng <span class="arithmatex">\(A\)</span> với khoảng thời gian là <span class="arithmatex">\(\mathcal{O}(\log{n})\)</span>.</p>
<p>Do thao tác lấy giá trị này phức tạp hơn thao tác cập nhật cây phân đoạn nên ta sẽ lấy một ví dụ minh họa để dễ hình dung: 
- Giả sử, cho mảng <span class="arithmatex">\(<span class="arithmatex">\(A = \{9,2,6,3,1,5,7\}\)</span>\)</span> và ta muốn biết phần tử nhỏ nhất trong đoạn <span class="arithmatex">\([1, 6]\)</span> của mảng <span class="arithmatex">\(A\)</span>.</p>
<p><img alt="/fptoj_wiki/uploads/segment-tree-basic_img4.png" src="/fptoj_wiki/uploads/segment-tree-basic_img4.png" /></p>
<ul>
<li>Gọi <span class="arithmatex">\(f(l,r)\)</span> là phần tử có giá trị nhỏ nhất trong đoạn <span class="arithmatex">\([l, r]\)</span>. Ta thấy rằng mỗi nút trong cây phân đoạn đều quản lí  một đoạn nào đó, ví dụ như nút gốc chứa <span class="arithmatex">\(f(1,7)\)</span>, nút con bên trái là <span class="arithmatex">\(f(1,4)\)</span>, nút bên phải là <span class="arithmatex">\(f(5,7)\)</span>, v.v...; và mỗi nút lá chứa <span class="arithmatex">\(f(i, i) = a_i\)</span>. Nhưng không có nút nào chứa <span class="arithmatex">\(f(1,6)\)</span>; tuy nhiên, ta nhận thấy rằng <span class="arithmatex">\(f(1,6) = \min{(f (1,4), f (5,6))}\)</span>, và có tồn tại các nút trong cây phân đoạn chứa hai giá trị đó <em>(được hiển thị bằng màu xanh dương trong hình trên)</em>.</li>
</ul>
<p>Dễ thấy rằng <span class="arithmatex">\(f (x, y) = \min{(f(x, z), f(z + 1, y)})\)</span> với <span class="arithmatex">\(x \le z &lt; y\)</span>. Do đó, ta phải xác định tập hợp ít nút nhất sao cho tổng tất cả các phạm vi mà các nút đó quản lí đúng bằng đoạn cần truy vấn. Sự kết hợp của tập hợp các nút đó chính xác là đáp án mà ta tìm kiếm.</p>
<p>Để làm như vậy, ta sẽ bắt đầu từ gốc và đệ quy qua các nút mà phạm vi quản lí của nó có ít nhất một phần tử chung với đoạn cần truy vấn. </p>
<p>Trong ví dụ trên với <span class="arithmatex">\(f(1,6)\)</span>, xét hai nút con của gốc, ta nhận thấy rằng cả nút con bên trái và bên phải đều quản lí một số các phần tử con thuộc đoạn cần truy vấn (đoạn <span class="arithmatex">\([1, 6]\)</span>). Do đó, ta sẽ thực hiện lệnh gọi đệ quy trên cả hai nút con của nút gốc. Khi đó, nút con bên trái của gốc đóng vai trò như một <strong>trường hợp cơ sở</strong>, vì phạm vi quản lí của nó được chứa hoàn toàn bên trong đoạn truy vấn; vậy nên nó được chọn <em>(đánh dấu bằng màu xanh dương)</em>. </p>
<p>Còn với nút con bên phải của gốc (nút chứa <span class="arithmatex">\(f(5, 7)\)</span>); ta nhận thấy rằng nút con bên trái của nút <span class="arithmatex">\(f(5, 7)\)</span>, tức là <span class="arithmatex">\(f(5, 6)\)</span> có quản lí một số các phần tử con thuộc đoạn cần truy vấn, nhưng nút con bên phải là <span class="arithmatex">\(f(7, 7)\)</span> thì không. Vì vậy, ta chỉ tiếp tục gọi đệ quy trên nút con bên trái là nút chứa <span class="arithmatex">\(f(5, 6)\)</span> và bỏ qua không gọi đệ quy nút con bên phải là nút chứa <span class="arithmatex">\(f(7, 7)\)</span>. </p>
<p>Khi đấy, nút con bên trái đó (nút <span class="arithmatex">\(f(5, 6)\)</span>) sẽ là một <strong>trường hợp cơ sở</strong> khác, nó cũng được chọn <em>(và đánh dấu bằng màu xanh dương)</em>. </p>
<p>Đệ quy kết thúc và giá trị nhỏ nhất của đoạn cần truy vấn chính là giá trị nhỏ nhất của các nút đã được chọn.</p>
<h1 id="cai-at">Cài đặt</h1>
<p>Thứ khiến ta cần phải cân nhắc ở đây chính là cách lưu trữ cây phân đoạn. Tất nhiên, ta có thể tạo ra một cấu trúc cây và danh sách cạnh, lưu trữ phạm vi quản lí của từng nút và các thông tin của nó. Tuy nhiên điều này đòi hỏi phải lưu trữ nhiều thông tin dư thừa. </p>
<p>Thay vào đó, ta sẽ sử dụng một thủ thuật đơn giản để làm cho việc này trở nên hiệu quả hơn rất nhiều. Ta sẽ chỉ lưu trữ các thông tin của từng nút vào trong một mảng. Thông tin của nút gốc lưu ở chỉ số <span class="arithmatex">\(1\)</span>, thông tin của hai nút con của nó lưu ở chỉ số <span class="arithmatex">\(2\)</span> và <span class="arithmatex">\(3\)</span>, thông tin của các nút con của hai nút đó sẽ lưu ở chỉ số từ <span class="arithmatex">\(4\)</span> đến <span class="arithmatex">\(7\)</span>, v.v... Dễ dàng nhận thấy, con bên trái của nút có chỉ số <span class="arithmatex">\(id\)</span> được lưu trữ tại chỉ số <span class="arithmatex">\(2 \times id\)</span> và con bên phải được lưu trữ tại chỉ số <span class="arithmatex">\(2 \times id + 1\)</span>.</p>
<ul>
<li>
<p><strong>Ví dụ minh họa:</strong> Cho mảng <span class="arithmatex">\(<span class="arithmatex">\(A = \{9,2,6,3,1,5,7\}\)</span>\)</span>, ta có <span class="arithmatex">\(<span class="arithmatex">\(st[] = \{1, 2, 1, 2, 3, 1, 7, 9, 2, 6, 3, 1, 5\}\)</span>\)</span> (với <span class="arithmatex">\(st[]\)</span> là mảng biểu diễn cho <strong>Segment Tree</strong>, lưu lại thông tin của mỗi nút).</p>
<p><img alt="/fptoj_wiki/uploads/segment-tree-basic_img5.png" src="/fptoj_wiki/uploads/segment-tree-basic_img5.png" /></p>
<ul>
<li>Chỉ số trên mảng được viết bằng màu đỏ bên cạnh mỗi nút, ví dụ như nút có chỉ số <span class="arithmatex">\(id = 2\)</span> sẽ quản lí đoạn <span class="arithmatex">\([1, 4]\)</span> và nút con bên trái của nó có chỉ số <span class="arithmatex">\(4\)</span>, còn nút con bên phải có chỉ số <span class="arithmatex">\(5\)</span>. </li>
</ul>
</li>
</ul>
<p>Điều này đơn giản hóa việc cài đặt rất nhiều. Ta không cần lưu hết toàn bộ cấu trúc của cây trong bộ nhớ. Mà nó sẽ được định nghĩa một cách ngầm định. Ta chỉ cần một mảng chứa thông tin của tất cả các phân đoạn.</p>
<p>Để dễ hình dung, ta lấy <span class="arithmatex">\(1\)</span> ví dụ cụ thể:</p>
<ul>
<li>Cho dãy <span class="arithmatex">\(A\)</span> gồm <span class="arithmatex">\(n\)</span> phần tử <span class="arithmatex">\(a_1, a_2, ..., a_n\)</span> <span class="arithmatex">\((1 \le n \le 10^5; \space \|a_i\| \le 10^9\)</span> với <span class="arithmatex">\(1 \le i \le n)\)</span>.</li>
<li>Có <span class="arithmatex">\(q\)</span> truy vấn <span class="arithmatex">\((1 \le q \le 10^5)\)</span>. Mỗi truy vấn thuộc <span class="arithmatex">\(1\)</span> trong <span class="arithmatex">\(2\)</span> loại:<ul>
<li><strong>Loại 1:</strong> Có dạng <span class="arithmatex">\(1 \space x \space y\)</span> : Gán giá trị <span class="arithmatex">\(y\)</span> cho phần tử ở vị trí <span class="arithmatex">\(x\)</span>.</li>
<li><strong>Loại 2:</strong> Có dạng <span class="arithmatex">\(2 \space l \space r\)</span> : Tìm phần tử có giá trị nhỏ nhất trong đoạn <span class="arithmatex">\([l, r]\)</span>.</li>
</ul>
</li>
</ul>
<p>Cách đơn giản nhất là dùng một mảng <span class="arithmatex">\(A\)</span> duy trì giá trị các phần tử. Với truy vấn <span class="arithmatex">\(1\)</span> thì ta gán <span class="arithmatex">\(A[x] = y\)</span>. Với truy vấn <span class="arithmatex">\(2\)</span> thì ta dùng một vòng lặp từ <span class="arithmatex">\(l\)</span> đến <span class="arithmatex">\(r\)</span> để tìm giá trị nhỏ nhất. Rõ ràng cách này có độ phức tạp là <span class="arithmatex">\(\mathcal{O}(n \times q)\)</span> và không thể chạy trong thời gian cho phép.</p>
<p>Do đó, ta sẽ cài đặt <strong>Segment Tree</strong> để giải quyết bài toán trên như sau:</p>
<p><strong>Cấu trúc dữ liệu:</strong></p>
<ul>
<li>Hằng số <code>maxN = 100007</code> .</li>
<li>Hằng số <code>inf = 1000000007</code> .</li>
<li>Mảng <code>st[]</code> - Lưu thông tin của mỗi nút trên <strong>Segment Tree</strong>.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;bits/stdc++.h&gt;</span>

<span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="p">;</span>

<span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">inf</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mf">1e9</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">7</span><span class="p">;</span>
<span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">maxN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1e5</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">7</span><span class="p">;</span>

<span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">;</span>
<span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="n">maxN</span><span class="p">];</span>
<span class="kt">int</span><span class="w"> </span><span class="n">st</span><span class="p">[</span><span class="mi">4</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">maxN</span><span class="p">];</span><span class="w"> </span><span class="c1">// Lí do sử dụng kích thước mảng là 4 * maxN sẽ được giải thích ở phần sau</span>

<span class="c1">// Thủ tục xây dựng cây phân đoạn</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">build</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Đoạn chỉ gồm 1 phần tử, không có nút con</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">st</span><span class="p">[</span><span class="n">id</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="n">l</span><span class="p">];</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Gọi đệ quy để xử lý các nút con của nút id</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">mid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="c1">// (l + r) / 2</span>
<span class="w">    </span><span class="n">build</span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">mid</span><span class="p">);</span>
<span class="w">    </span><span class="n">build</span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">mid</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Cập nhật lại giá trị min của đoạn [l, r] theo 2 nút con</span>
<span class="w">    </span><span class="n">st</span><span class="p">[</span><span class="n">id</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">min</span><span class="p">(</span><span class="n">st</span><span class="p">[</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">id</span><span class="p">],</span><span class="w"> </span><span class="n">st</span><span class="p">[</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">]);</span>
<span class="p">}</span>

<span class="c1">// Thủ tục cập nhật</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">val</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// i nằm ngoài đoạn [l, r], ta bỏ qua nút id</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Đoạn chỉ gồm 1 phần tử, không có nút con</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">st</span><span class="p">[</span><span class="n">id</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">val</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Gọi đệ quy để xử lý các nút con của nút id</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">mid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="c1">// (l + r) / 2</span>
<span class="w">    </span><span class="n">update</span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">mid</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">val</span><span class="p">);</span>
<span class="w">    </span><span class="n">update</span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">mid</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">val</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Cập nhật lại giá trị min của đoạn [l, r] theo 2 nút con</span>
<span class="w">    </span><span class="n">st</span><span class="p">[</span><span class="n">id</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">min</span><span class="p">(</span><span class="n">st</span><span class="p">[</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">id</span><span class="p">],</span><span class="w"> </span><span class="n">st</span><span class="p">[</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">]);</span>
<span class="p">}</span>


<span class="c1">// Hàm lấy giá trị</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Đoạn [u, v] không giao với đoạn [l, r], ta bỏ qua đoạn này</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">&gt;</span><span class="w">  </span><span class="n">v</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">&lt;</span><span class="w">  </span><span class="n">u</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">inf</span><span class="p">;</span><span class="w"> </span>

<span class="w">    </span><span class="cm">/* Đoạn [l, r] nằm hoàn toàn trong đoạn [u, v] mà ta đang truy vấn, </span>
<span class="cm">        ta trả lại thông tin lưu ở nút id */</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">st</span><span class="p">[</span><span class="n">id</span><span class="p">];</span>

<span class="w">    </span><span class="c1">// Gọi đệ quy với các nút con của nút id</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">mid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="c1">// (l + r) / 2</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">get1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get</span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">mid</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">);</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">get2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get</span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">mid</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Trả ra giá trị nhỏ nhất theo 2 nút con</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">min</span><span class="p">(</span><span class="n">get1</span><span class="p">,</span><span class="w"> </span><span class="n">get2</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">n</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="w">    </span><span class="n">build</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">);</span>

<span class="w">    </span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">q</span><span class="p">;</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">q</span><span class="o">--</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">type</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
<span class="w">        </span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">);</span><span class="w"> </span><span class="c1">// Gán giá trị y cho phần tử ở vị trí x </span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">get</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">&#39;\n&#39;</span><span class="p">;</span><span class="w"> </span><span class="c1">// In ra giá trị nhỏ nhất trong đoạn [x, y]</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="anh-gia">Đánh giá</h2>
<p>Ở phần <strong><a href="algo/data-structures/segment-tree-basic">Các thao tác trên cây phân đoạn</a></strong> có nhắc đến <span class="arithmatex">\(2\)</span> cách để cài đặt <strong>Segment Tree</strong>. Vì sự khác biệt về tốc độ của hai cách có thể là không đáng kể, nên bài viết này sẽ chỉ cài đặt theo cách thông thường nhất là sử dụng <strong>phương pháp đệ quy</strong>.</p>
<p><strong>Segment Tree</strong> còn có một cách cài đặt khác sử dụng ít bộ nhớ hơn (sử dụng tối đa <span class="arithmatex">\(2 \times N\)</span> phần tử), cài đặt ngắn hơn và chạy nhanh hơn. Tuy nhiên thì nó không dễ hiểu bằng cách cài đặt trên. <em>Bạn có thể tham khảo thêm tại đây:</em> <strong><em><a href="translate/codeforces/Efficient-and-easy-segment-trees">VNOI - Efficient and easy segment trees</a></em></strong>.</p>
<h1 id="phan-tich-o-phuc-tap">Phân tích độ phức tạp</h1>
<h2 id="bo-nho">Bộ nhớ</h2>
<p>Ta xét <span class="arithmatex">\(2\)</span> trường hợp:</p>
<ul>
<li><strong>TH1:</strong> <span class="arithmatex">\(N = 2^k\)</span> : Cây phân đoạn đầy đủ, ở độ sâu cuối cùng có đúng <span class="arithmatex">\(2^k\)</span> lá, và các độ sâu thấp hơn không có nút lá nào (và các nút này đều có đúng <span class="arithmatex">\(2\)</span> con). Như vậy:<ul>
<li>Tầng <span class="arithmatex">\(k\)</span> : có <span class="arithmatex">\(2^k\)</span> nút</li>
<li>Tầng <span class="arithmatex">\(k-1\)</span> : có <span class="arithmatex">\(2^{k-1}\)</span> nút</li>
<li>...
<span class="arithmatex">\(\Rightarrow\)</span> Tổng số nút không quá <span class="arithmatex">\(2^{k+1}\)</span> (vì <strong>tổng số nút</strong> <span class="arithmatex">\(= 2^k + 2^{k-1} +  \ldots + 2^0 = 2^{k+1} - 1\)</span> theo công thức cấp số nhân).</li>
</ul>
</li>
<li><strong>TH2:</strong> Với <span class="arithmatex">\(N &gt; 2^k\)</span> và <span class="arithmatex">\(N &lt; 2^{k+1}\)</span> : Số nút của cây phân đoạn không quá số nút của cây phân đoạn với <span class="arithmatex">\(N = 2^{k+1}\)</span>.</li>
</ul>
<p>Do đó, số nút của cây cho dãy <span class="arithmatex">\(N\)</span> phần tử (với <span class="arithmatex">\(N \le 2^k\)</span>) là không quá <span class="arithmatex">\(2^{k+1}\)</span>, giá trị này xấp xỉ <span class="arithmatex">\(4 \times N\)</span>. Bằng thực nghiệm, ta thấy dùng <span class="arithmatex">\(4 \times N\)</span> là đủ.</p>
<p><em>Tham khảo thêm các cách chứng minh khác tại đây: <a href="http://codeforces.com/blog/entry/49939"><strong>Codeforces – Blog entry 49939</strong></a>.</em></p>
<h2 id="thoi-gian">Thời gian</h2>
<h3 id="thao-tac-xay-dung">Thao tác xây dựng</h3>
<p>Thao tác xây dựng sẽ yêu cầu một số lượng hoạt động không đổi trên mỗi nút của cây phân đoạn. Với mảng có <span class="arithmatex">\(N\)</span> phần tử thì số lượng nút của cây phân đoạn xấp xỉ <span class="arithmatex">\(4 \times N\)</span> <em>(đã chứng minh ở trên)</em>, và vì thao tác xây dựng mất thời gian tuyến tính nên sẽ có độ phức tạp là <span class="arithmatex">\(\mathcal{O}(4 \times N)\)</span>. </p>
<p>Ta có thể nhận thấy rằng thao tác xây dựng nhanh hơn so với việc thực hiện các thao tác cập nhật riêng biệt <em>(việc duyệt từng phần tử của mảng để cập nhật sẽ mất độ phức tạp <span class="arithmatex">\(\mathcal{O}(N \times \log{N})\)</span> )</em>.</p>
<h3 id="thao-tac-cap-nhat">Thao tác cập nhật</h3>
<p>Với thao tác cập nhật, một số lượng các hoạt động không đổi được thực hiện cho mỗi nút trên đường đi đơn từ gốc đến nút lá tương ứng với phần tử cần sửa đổi. Đồng nghĩa với việc ở mỗi độ sâu của cây, ta chỉ gọi đệ quy tới không quá <span class="arithmatex">\(1\)</span> nút con. </p>
<p>Phân tích đoạn <em>code</em> trên, ta xét các trường hợp:
- Phần tử cần xét không nằm trong đoạn <span class="arithmatex">\([l, r]\)</span> do nút <span class="arithmatex">\(id\)</span> quản lý. Trường hợp này ta dừng lại, không xét tiếp.
- Phần tử cần xét nằm trong đoạn <span class="arithmatex">\([l, r]\)</span> do nút <span class="arithmatex">\(id\)</span> quản lý. Ta xét các con của nút <span class="arithmatex">\(id\)</span>. Tuy nhiên chỉ có <span class="arithmatex">\(1\)</span> con của nút <span class="arithmatex">\(id\)</span> chứa phần tử cần xét và ta sẽ phải xét tiếp các con của nút này. Với nút con còn lại, ta sẽ dừng ngay mà không xét các con của nó nữa.</p>
<p>Vì số lượng các nút trên đường đi đơn từ gốc đến nút lá tương ứng được giới hạn bởi chiều cao của cây là <span class="arithmatex">\(\mathcal{O}(\log{N})\)</span> nên độ phức tạp của thao tác cập nhật sẽ là <span class="arithmatex">\(\mathcal{O}(\log{N})\)</span>.</p>
<h3 id="thao-tac-lay-gia-tri">Thao tác lấy giá trị</h3>
<p>Trước tiên, ta hãy xem xét từng độ sâu của của cây. Từ đó có thể thấy rằng đối với mỗi độ sâu, ta chỉ truy cập không quá <span class="arithmatex">\(4\)</span> nút. Và vì chiều cao của cây là <span class="arithmatex">\(\mathcal{O}(\log{N})\)</span> nên độ phức tạp của thao tác lấy giá trị là <span class="arithmatex">\(\mathcal{O}(\log{N})\)</span>.</p>
<p>Ta có thể chứng minh rằng mệnh đề này <em>(truy cập nhiều nhất bốn nút trong mỗi độ sâu)</em> là đúng bằng <strong>phương pháp quy nạp</strong>:
- Ở độ sâu đầu tiên, ta chỉ truy cập duy nhất một nút là nút gốc, vì vậy ở đây ta truy cập ít hơn <span class="arithmatex">\(4\)</span> nút. 
- Bây giờ, ta hãy xem xét một độ sâu bất kì. Theo giả thuyết quy nạp là ta thăm nhiều nhất <span class="arithmatex">\(4\)</span> nút. Nếu ta chỉ thăm nhiều nhất <span class="arithmatex">\(2\)</span> nút, thì ở độ sâu tiếp theo, số lượng nút được thăm nhiều nhất sẽ là <span class="arithmatex">\(4\)</span> nút. Điều đó thật hiển nhiên, bởi vì mỗi nút có thể tạo ra nhiều nhất <span class="arithmatex">\(2\)</span> lệnh gọi đệ quy. 
- Vì vậy, giả sử rằng ta truy cập <span class="arithmatex">\(3\)</span> hoặc <span class="arithmatex">\(4\)</span> nút trong độ sâu hiện tại. Từ các nút đó, ta sẽ phân tích kỹ hơn các nút nằm ở giữa (nghĩa là nút thứ hai từ trái sang với số lượng nút đang được truy cập là <span class="arithmatex">\(3\)</span> và nút thứ <span class="arithmatex">\(2, \space 3\)</span> với số nút đang được truy cập là <span class="arithmatex">\(4\)</span>) . Vì truy vấn yêu cầu lấy giá trị của một đoạn con liên tục, ta biết rằng các phân đoạn tương ứng với các nút đã thăm ở giữa sẽ được bao phủ hoàn toàn bởi phân đoạn của truy vấn. Do đó các nút này sẽ không thực hiện bất kỳ lệnh gọi đệ quy nào tới các nút con nữa. Vì vậy, chỉ nút bên trái nhất và nút bên phải nhất mới có khả năng tiếp tục gọi đệ quy. Và hai nút đó sẽ chỉ tạo ra nhiều nhất <span class="arithmatex">\(4\)</span> lệnh gọi đệ quy, vì vậy độ sâu tiếp theo cũng sẽ đáp ứng đúng mệnh đề. 
    - <strong>Ví dụ:</strong> Giả sử, đoạn cần truy vấn là đoạn <span class="arithmatex">\([2, 5]\)</span>. Ở độ sâu thứ <span class="arithmatex">\(3\)</span>, ta sẽ truy cập vào ba nút quản lí các đoạn <span class="arithmatex">\([1, 2]\)</span>, <span class="arithmatex">\([3, 4]\)</span> và <span class="arithmatex">\([5, 6]\)</span> <em>(được đánh dấu bằng màu xanh dương)</em>. Khi đó, vì nút quản lí đoạn <span class="arithmatex">\([3, 4]\)</span> nằm hoàn toàn bên trong đoạn <span class="arithmatex">\([2, 5]\)</span> nên hàm đệ quy sẽ trả ra luôn giá trị của nút đó, mà <strong>không</strong> gọi đệ quy tới các nút con. Chỉ có hai nút là nút bên trái nhất quản lí đoạn <span class="arithmatex">\([1, 2]\)</span> và nút bên phải nhất quản lí đoạn <span class="arithmatex">\([5, 6]\)</span> mới được tiếp tục gọi đệ quy.</p>
<pre><code>![/fptoj_wiki/uploads/segment-tree-basic_img6.png](/fptoj_wiki/uploads/segment-tree-basic_img6.png)
</code></pre>
<ul>
<li>Ta cũng có thể nói rằng một nhánh cây phân đoạn sẽ tiếp cận dần tới giới hạn bên trái của truy vấn và nhánh thứ hai tiếp cận tới giới hạn bên phải.</li>
</ul>
<p>Do đó, ta sẽ chỉ truy cập nhiều nhất <span class="arithmatex">\(4 \times \log{N}\)</span> nút trên cây phân đoạn, và đó cũng chính là độ phức tạp của thao tác lấy giá trị.</p>
<h1 id="vi-du-1">Ví dụ 1</h1>
<p><a href="https://oj.vnoi.info/problem/segtree_itez2">VNOI - ITEZ2</a></p>
<h2 id="bai-toan">Bài toán</h2>
<p>Bạn được cho một mảng gồm <span class="arithmatex">\(n\)</span> số nguyên. Ban đầu tất cả các số của mảng đều là <span class="arithmatex">\(0\)</span>. Nhiệm vụ của bạn là xử lí <span class="arithmatex">\(2\)</span> loại truy vấn:
- Loại <span class="arithmatex">\(1\)</span> có dạng <span class="arithmatex">\(1 \space x \space y\)</span> : Gán phần tử ở vị trí thứ <span class="arithmatex">\(x\)</span> trong dãy thành số <span class="arithmatex">\(y\)</span> <span class="arithmatex">\((1 \le x \le n, \|y\| \le 10^9)\)</span>.
- Loại <span class="arithmatex">\(2\)</span> có dạng <span class="arithmatex">\(2 \space l \space r\)</span> : In ra tổng các phần tử trong đoạn từ <span class="arithmatex">\(l\)</span> đến <span class="arithmatex">\(r\)</span> <span class="arithmatex">\((1 \le l \le r \le n)\)</span>.</p>
<p>Với mỗi truy vấn loại <span class="arithmatex">\(2\)</span>, hãy in ra câu trả lời trên một dòng.</p>
<p><span class="arithmatex">\(\circ \space \space 1 \le n, q \le 10^5\)</span> (với <span class="arithmatex">\(q\)</span> là số lượng truy vấn).</p>
<h2 id="phan-tich">Phân tích</h2>
<p>Vì ban đầu giá trị của tất cả phần tử trong mảng đều bằng <span class="arithmatex">\(0\)</span> nên ta không cần phải thực hiện thao tác xây dựng cây phân đoạn.</p>
<p>Nhận thấy rằng, trên cây phân đoạn, mỗi nút không phải lá sẽ chứa tổng giá trị tại các nút con của nó. Do đó, ta chỉ cần thay thế tất cả các phép toán <em>min</em> ở ví dụ trên <em>(trong phần <strong><a href="algo/data-structures/segment-tree-basic">Cài đặt</a></strong>)</em> bằng các phép toán cộng.</p>
<h2 id="cai-at_1">Cài đặt</h2>
<p><strong>Cấu trúc dữ liệu:</strong></p>
<ul>
<li>Hằng số <code>maxN = 100007</code>.</li>
<li>Mảng <code>st[]</code> - Lưu thông tin của mỗi nút trên <strong>Segment Tree</strong>.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;bits/stdc++.h&gt;</span>

<span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="p">;</span>

<span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">maxN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1e5</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">7</span><span class="p">;</span>

<span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">;</span>
<span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="n">maxN</span><span class="p">];</span>
<span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">st</span><span class="p">[</span><span class="mi">4</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">maxN</span><span class="p">];</span>

<span class="c1">// Thủ tục cập nhật</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">val</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">st</span><span class="p">[</span><span class="n">id</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">val</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">mid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="n">update</span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">mid</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">val</span><span class="p">);</span>
<span class="w">    </span><span class="n">update</span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">mid</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">val</span><span class="p">);</span>
<span class="w">    </span><span class="n">st</span><span class="p">[</span><span class="n">id</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">st</span><span class="p">[</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">id</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">st</span><span class="p">[</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span>
<span class="p">}</span>

<span class="c1">// Hàm lấy tổng giá trị</span>
<span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">&gt;</span><span class="w">  </span><span class="n">v</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">&lt;</span><span class="w">  </span><span class="n">u</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">st</span><span class="p">[</span><span class="n">id</span><span class="p">];</span>

<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">mid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">get1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get</span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">mid</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">);</span>
<span class="w">    </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">get2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get</span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">mid</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">get1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">get2</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">q</span><span class="p">;</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">q</span><span class="o">--</span><span class="p">){</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">type</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
<span class="w">        </span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">);</span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">get</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">&#39;\n&#39;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="anh-gia_1">Đánh giá</h2>
<p><strong>Độ phức tạp</strong></p>
<p>Với mỗi truy vấn, ta sẽ mất <span class="arithmatex">\(\mathcal{O}(\log{n})\)</span> cho mỗi thao tác trên <strong>Segment Tree</strong>. Do đó, độ phức tạp của thuật toán là <span class="arithmatex">\(\mathcal{O}(q \times \log{n})\)</span>.</p>
<h1 id="vi-du-2">Ví dụ 2</h1>
<p><a href="https://oj.vnoi.info/problem/gss">VNOI - GSS</a></p>
<h2 id="bai-toan_1">Bài toán</h2>
<p>Cho dãy số <span class="arithmatex">\(a_1, a_2, ..., a_n\)</span> <span class="arithmatex">\((\|a_i\| \le 15000, \space n \le 50000)\)</span>.</p>
<p>Hàm <span class="arithmatex">\(q(x, y)\)</span> =  <span class="arithmatex">\(\max \Big( \displaystyle\sum_{k = i}^{j} a_k\)</span>, với <span class="arithmatex">\(x \le i \le j \le y \Big)\)</span>.</p>
<p>Cho <span class="arithmatex">\(m\)</span> <span class="arithmatex">\((m \le 50000)\)</span> câu hỏi dạng <span class="arithmatex">\(x, y\)</span> <span class="arithmatex">\((1 \le x \le y \le n)\)</span>, hãy tính các <span class="arithmatex">\(q(x, y)\)</span>.</p>
<h2 id="phan-tich_1">Phân tích</h2>
<p>Ở bài toán này, mỗi nút của cây phân đoạn lưu lại các thông tin sau:
- <code>pre</code> : Tiền tố có tổng giá trị lớn nhất trên đoạn.
- <code>suf</code> : Hậu tố có tổng giá trị lớn nhất trên đoạn.
- <code>sum</code> : Tổng giá trị các phần tử trên đoạn.
- <code>maxsum</code> : Tổng giá trị lớn nhất của đoạn con nằm trong đoạn mà nút đó quản lí.</p>
<p>Bây giờ, ta cần phải xác định các phép toán để "hợp nhất" hai nút con:
- <code>pre</code> : Dễ thấy rằng tiền tố lớn nhất của nút cha sẽ bằng <em>max</em> tiền tố của nút con bên trái và tổng giá trị của nút con bên trái cộng với tiền tố của nút con bên phải.
    - <strong>Minh họa:</strong> <span class="arithmatex">\(\mathrm{pre}[l, r] = \max{(\mathrm{pre}[l, mid], \space \mathrm{sum}[l, mid] + \mathrm{pre}[mid + 1, r])}\)</span> với <span class="arithmatex">\(mid = \big\lfloor \frac{l + r}{2} \big\rfloor\)</span>.</p>
<pre><code>![/fptoj_wiki/uploads/segment-tree-basic_img7.png](/fptoj_wiki/uploads/segment-tree-basic_img7.png)
</code></pre>
<ul>
<li><code>suf</code> : Hậu tố lớn nhất của nút cha sẽ bằng <em>max</em> hậu tố của nút con bên phải và tổng giá trị của nút con bên phải cộng với hậu tố của nút con bên trái. <em>Cách tính hậu tố tương tự như với tiền tố nên sẽ không minh họa lại nữa.</em></li>
<li><code>sum</code> : Ta có thể dễ dàng tính toán giống như ở <strong><a href="algo/data-structures/segment-tree-basic">Ví dụ 1</a></strong> bằng cách lấy tổng giá trị <span class="arithmatex">\(2\)</span> nút con.</li>
<li>
<p><code>maxsum</code> : </p>
<ul>
<li>Xét <span class="arithmatex">\(3\)</span> trường hợp:<ul>
<li><strong>TH1:</strong> Đoạn con có tổng lớn nhất nằm hoàn toàn bên trong nút con bên trái.</li>
<li><strong>TH2:</strong> Đoạn con có tổng lớn nhất nằm hoàn toàn bên trong nút con bên phải.</li>
<li><strong>TH3:</strong> Một phần của đoạn con có tổng lớn nhất nằm ở nút con bên phải, và phần còn lại nằm ở nút con bên trái.</li>
</ul>
</li>
<li>Ở <span class="arithmatex">\(2\)</span> trường hợp đầu tiên thì ta chỉ cần trực tiếp lấy giá trị của đoạn con lớn nhất từ các nút con.</li>
<li>
<p>Ở trường hợp thứ <span class="arithmatex">\(3\)</span>, giá trị của đoạn con lớn nhất sẽ là tổng hậu tố lớn nhất của nút con bên trái với tiền tố lớn nhất của nút con bên phải.</p>
<ul>
<li><strong>Minh họa:</strong> Trường hợp <span class="arithmatex">\(3\)</span>, với <span class="arithmatex">\(mid = \big\lfloor \frac{l + r}{2} \big\rfloor\)</span> :</li>
</ul>
<p><img alt="/fptoj_wiki/uploads/segment-tree-basic_img8.png" src="/fptoj_wiki/uploads/segment-tree-basic_img8.png" /></p>
</li>
<li>
<p>Khi đó, giá trị của đoạn con lớn nhất nằm trong đoạn được quản lí bởi nút cha sẽ là giá trị lớn nhất của cả ba trường hợp trên.</p>
</li>
</ul>
</li>
</ul>
<p>Với mỗi truy vấn, đáp án chính là <span class="arithmatex">\(\mathrm{maxsum}[x, y]\)</span>.</p>
<h2 id="cai-at_2">Cài đặt</h2>
<p><strong>Cấu trúc dữ liệu:</strong></p>
<ul>
<li>Hằng số <code>inf = 1000000007</code>.</li>
<li>Hằng số <code>maxN = 50007</code>.</li>
<li>Mảng <code>st[]</code> - Lưu thông tin của mỗi nút trên <strong>Segment Tree</strong>.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;bits/stdc++.h&gt;</span>

<span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="p">;</span>

<span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">inf</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mf">1e9</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">7</span><span class="p">;</span>
<span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">maxN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">5e4</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">7</span><span class="p">;</span>

<span class="c1">// Thông tin của mỗi nút</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">node</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">pre</span><span class="p">,</span><span class="w"> </span><span class="n">suf</span><span class="p">,</span><span class="w"> </span><span class="n">sum</span><span class="p">,</span><span class="w"> </span><span class="n">maxsum</span><span class="p">;</span><span class="w">  </span>

<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="nf">base</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">-</span><span class="n">inf</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">inf</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">inf</span><span class="w"> </span><span class="p">};</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Hàm hợp nhất 2 nút con</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="nf">merge</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">node</span><span class="o">&amp;</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">node</span><span class="o">&amp;</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w">  </span><span class="p">{</span>
<span class="w">        </span><span class="n">node</span><span class="w"> </span><span class="n">res</span><span class="p">;</span>
<span class="w">        </span><span class="n">res</span><span class="p">.</span><span class="n">pre</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">pre</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">pre</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">sum</span><span class="p">);</span>
<span class="w">        </span><span class="n">res</span><span class="p">.</span><span class="n">suf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">suf</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">suf</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">sum</span><span class="p">);</span>
<span class="w">        </span><span class="n">res</span><span class="p">.</span><span class="n">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">sum</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">sum</span><span class="p">;</span>
<span class="w">        </span><span class="n">res</span><span class="p">.</span><span class="n">maxsum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">maxsum</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">maxsum</span><span class="p">);</span>
<span class="w">        </span><span class="n">res</span><span class="p">.</span><span class="n">maxsum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">res</span><span class="p">.</span><span class="n">maxsum</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">suf</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">pre</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">res</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>

<span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">;</span>
<span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="n">maxN</span><span class="p">];</span>
<span class="n">node</span><span class="w"> </span><span class="n">st</span><span class="p">[</span><span class="mi">4</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">maxN</span><span class="p">];</span>

<span class="c1">// Thủ tục xây dựng cây phân đoạn</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">build</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">st</span><span class="p">[</span><span class="n">id</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="n">l</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="n">l</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="n">l</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="n">l</span><span class="p">]</span><span class="w"> </span><span class="p">};</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">mid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="n">build</span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">mid</span><span class="p">);</span>
<span class="w">    </span><span class="n">build</span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">mid</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">);</span>
<span class="w">    </span><span class="n">st</span><span class="p">[</span><span class="n">id</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">node</span><span class="o">::</span><span class="n">merge</span><span class="p">(</span><span class="n">st</span><span class="p">[</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">id</span><span class="p">],</span><span class="w"> </span><span class="n">st</span><span class="p">[</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">]);</span>
<span class="p">}</span>

<span class="c1">// Hàm lấy giá trị</span>
<span class="n">node</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="p">){</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">&gt;</span><span class="w">  </span><span class="n">v</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">&lt;</span><span class="w">  </span><span class="n">u</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">node</span><span class="o">::</span><span class="n">base</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">st</span><span class="p">[</span><span class="n">id</span><span class="p">];</span>

<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">mid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="n">node</span><span class="w"> </span><span class="n">g1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get</span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">mid</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">);</span>
<span class="w">    </span><span class="n">node</span><span class="w"> </span><span class="n">g2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get</span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">mid</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">node</span><span class="o">::</span><span class="n">merge</span><span class="p">(</span><span class="n">g1</span><span class="p">,</span><span class="w"> </span><span class="n">g2</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">n</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="w">    </span><span class="n">build</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">);</span>

<span class="w">    </span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">m</span><span class="p">;</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">m</span><span class="o">--</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
<span class="w">        </span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
<span class="w">        </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">get</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">).</span><span class="n">maxsum</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">&#39;\n&#39;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="anh-gia_2">Đánh giá</h2>
<p><strong>Độ phức tạp</strong></p>
<p>Để xây dựng cây phân đoạn, ta mất độ phức tạp <span class="arithmatex">\(\mathcal{O}(4 \times n)\)</span>. Với mỗi truy vấn, ta mất thêm độ phức tạp <span class="arithmatex">\(\mathcal{O}(\log{n})\)</span> cho mỗi thao tác lấy giá trị trên <strong>Segment Tree</strong>. </p>
<p>Nhìn chung, độ phức tạp của thuật toán là <span class="arithmatex">\(\mathcal{O}(4 \times n + m \times \log{n})\)</span>.</p>
<h1 id="vi-du-3">Ví dụ 3</h1>
<p><a href="https://oj.vnoi.info/problem/segtree_itds1">VNOI - ITDS1</a></p>
<h2 id="bai-toan_2">Bài toán</h2>
<p>Cho một dãy số có <span class="arithmatex">\(N\)</span> số. Bạn cần xử lí <span class="arithmatex">\(2\)</span> loại truy vấn:
- Truy vấn loại <span class="arithmatex">\(1\)</span> có dạng <span class="arithmatex">\(1 \space i \space v\)</span>, ta đổi số ở vị trí <span class="arithmatex">\(i\)</span> thành <span class="arithmatex">\(v\)</span>.
- Truy vấn loại <span class="arithmatex">\(2\)</span> có dạng <span class="arithmatex">\(2 \space L \space R \space k\)</span>, ta cần in ra số nhỏ nhất mà lớn hơn bằng <span class="arithmatex">\(k\)</span> trong khoảng <span class="arithmatex">\([L..R]\)</span>.</p>
<p><span class="arithmatex">\(\circ \space \space 1 \le N, M \le 10^5\)</span> (với <span class="arithmatex">\(M\)</span> là số lượng truy vấn).</p>
<h2 id="phan-tich_2">Phân tích</h2>
<p>Trong bài toán này, mỗi nút của cây phân đoạn là một <strong><em><a href="http://www.cplusplus.com/reference/set/multiset/">multiset</a></em></strong> chứa các phần tử trong đoạn mà nó quản lí. Khi đó, để hợp nhất các nút con, ta chỉ cần <em>insert</em> toàn bộ phần tử của cả <span class="arithmatex">\(2\)</span> nút con vào nút cha. </p>
<p>Mỗi khi cập nhật cây phân đoạn, nếu ta duyệt từng phần tử của các nút con để <em>insert</em> vào nút cha thì với số lượng truy vấn <span class="arithmatex">\(M\)</span>, ta sẽ mất độ phức tạp lên tới hơn <span class="arithmatex">\(\mathcal{O}(M \times N)\)</span> <em>(chưa kể độ phức tạp của các thao tác trên multiset)</em>, vì số lượng phần tử của mỗi nút có thể lên tới <span class="arithmatex">\(N\)</span>.</p>
<p>Thay vào đó, ta nhận thấy rằng, khi thay đổi giá trị <span class="arithmatex">\(a[i]\)</span> thành <span class="arithmatex">\(v\)</span> thì tất cả <em>multiset</em> của các nút quản lí phân đoạn chứa phần tử <span class="arithmatex">\(a[i]\)</span> <em>(các nút nằm trên đường đi đơn từ gốc đến nút lá tương ứng)</em> đều sẽ phải xóa đi một giá trị <span class="arithmatex">\(a[i]\)</span> và thêm vào một giá trị <span class="arithmatex">\(v\)</span>. Do đó, với truy vấn loại <span class="arithmatex">\(1\)</span>, khi cập nhật một nút, ta không cần phải <em>insert</em> lại toàn bộ phần tử của cả <span class="arithmatex">\(2\)</span> nút con, mà chỉ cần xóa đi một giá trị cũ trong <em>multiset</em> và chèn thêm giá trị mới. </p>
<p>Với truy vấn loại <span class="arithmatex">\(2\)</span>, ta thực hiện tương tự như thao tác lấy giá trị. Tuy nhiên, mỗi khi xét đến nút mà đoạn nó quản lí nằm hoàn toàn bên trong đoạn cần truy vấn <em>(trường hợp cơ sở)</em>, ta sử dụng hàm <a href="https://www.cplusplus.com/reference/set/multiset/lower_bound/"><span class="arithmatex">\(\textit{lower_bound()}\)</span></a> để trả ra giá trị nhỏ nhất mà vẫn lớn hơn hoặc bằng <span class="arithmatex">\(k\)</span> trong <em>multiset</em> của nút đó.</p>
<h2 id="cai-at_3">Cài đặt</h2>
<p><strong>Cấu trúc dữ liệu:</strong></p>
<ul>
<li>Hằng số <code>inf = 1000000007</code>.</li>
<li>Hằng số <code>maxN = 100007</code>.</li>
<li>Mảng <code>st[]</code> - Lưu thông tin của mỗi nút trên <strong>Segment Tree</strong>.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;bits/stdc++.h&gt;</span>

<span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="p">;</span>

<span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">inf</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mf">1e9</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">7</span><span class="p">;</span>
<span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">maxN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1e5</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">7</span><span class="p">;</span>

<span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">;</span>
<span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="n">maxN</span><span class="p">];</span>
<span class="n">multiset</span><span class="w"> </span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">st</span><span class="p">[</span><span class="mi">4</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">maxN</span><span class="p">];</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">build</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">st</span><span class="p">[</span><span class="n">id</span><span class="p">].</span><span class="n">insert</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">l</span><span class="p">]);</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">mid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="n">build</span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">mid</span><span class="p">);</span>
<span class="w">    </span><span class="n">build</span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">mid</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">);</span>

<span class="w">    </span><span class="n">st</span><span class="p">[</span><span class="n">id</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">st</span><span class="p">[</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">st</span><span class="p">[</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">id</span><span class="p">])</span><span class="w"> </span><span class="n">st</span><span class="p">[</span><span class="n">id</span><span class="p">].</span><span class="n">insert</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">old</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">val</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">st</span><span class="p">[</span><span class="n">id</span><span class="p">].</span><span class="n">clear</span><span class="p">();</span>
<span class="w">        </span><span class="n">st</span><span class="p">[</span><span class="n">id</span><span class="p">].</span><span class="n">insert</span><span class="p">(</span><span class="n">val</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">mid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="n">update</span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">mid</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">old</span><span class="p">,</span><span class="w"> </span><span class="n">val</span><span class="p">);</span>
<span class="w">    </span><span class="n">update</span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">mid</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">old</span><span class="p">,</span><span class="w"> </span><span class="n">val</span><span class="p">);</span>
<span class="w">    </span><span class="n">st</span><span class="p">[</span><span class="n">id</span><span class="p">].</span><span class="n">erase</span><span class="p">(</span><span class="n">st</span><span class="p">[</span><span class="n">id</span><span class="p">].</span><span class="n">find</span><span class="p">(</span><span class="n">old</span><span class="p">));</span>
<span class="w">    </span><span class="n">st</span><span class="p">[</span><span class="n">id</span><span class="p">].</span><span class="n">insert</span><span class="p">(</span><span class="n">val</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">&gt;</span><span class="w">  </span><span class="n">v</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">&lt;</span><span class="w">  </span><span class="n">u</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">inf</span><span class="p">;</span><span class="w"> </span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">st</span><span class="p">[</span><span class="n">id</span><span class="p">].</span><span class="n">lower_bound</span><span class="p">(</span><span class="n">k</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">it</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">st</span><span class="p">[</span><span class="n">id</span><span class="p">].</span><span class="n">end</span><span class="p">())</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">inf</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">*</span><span class="n">it</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">mid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">get1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get</span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">mid</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">);</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">get2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get</span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">mid</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">min</span><span class="p">(</span><span class="n">get1</span><span class="p">,</span><span class="w"> </span><span class="n">get2</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">m</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="w">    </span><span class="n">build</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">);</span>

<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">m</span><span class="o">--</span><span class="p">){</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">type</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">;</span>
<span class="w">        </span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">type</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">k</span><span class="p">;</span>
<span class="w">            </span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="n">l</span><span class="p">],</span><span class="w"> </span><span class="n">k</span><span class="p">);</span>
<span class="w">            </span><span class="n">a</span><span class="p">[</span><span class="n">l</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">k</span><span class="p">;</span>
<span class="w">            </span><span class="kt">int</span><span class="w"> </span><span class="n">ans</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">);</span>
<span class="w">            </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">((</span><span class="n">ans</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">inf</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mi">-1</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">ans</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">&#39;\n&#39;</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="anh-gia_3">Đánh giá</h2>
<p>Ngoài ra còn có cách cài đặt khác đơn giản hơn, ta có thể cài đặt hàm <code>update</code> theo cách cập nhật <em>"từ dưới lên trên"</em> (không sử dụng đệ quy) như sau:
 - Ta sẽ bắt đầu xuất phát từ nút lá tương ứng với phần tử cần sửa đổi và đi dần lên nút gốc. </p>
<div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">val</span><span class="p">){</span>
<span class="w">    </span><span class="cm">/* leaf[i] là chỉ số của nút lá tương ứng với </span>
<span class="cm">    phần tử ở vị trí i trong dãy số */</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">leaf</span><span class="p">[</span><span class="n">i</span><span class="p">];</span><span class="w"> </span>

<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">old</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">st</span><span class="p">[</span><span class="n">id</span><span class="p">].</span><span class="n">begin</span><span class="p">();</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">st</span><span class="p">[</span><span class="n">id</span><span class="p">].</span><span class="n">erase</span><span class="p">(</span><span class="n">st</span><span class="p">[</span><span class="n">id</span><span class="p">].</span><span class="n">find</span><span class="p">(</span><span class="n">old</span><span class="p">));</span>
<span class="w">        </span><span class="n">st</span><span class="p">[</span><span class="n">id</span><span class="p">].</span><span class="n">insert</span><span class="p">(</span><span class="n">val</span><span class="p">);</span>
<span class="w">        </span><span class="n">id</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><em>Tham khảo code chuẩn tại <a href="https://ideone.com/NQjQEa">đây</a>.</em></p>
<p><strong>Độ phức tạp</strong></p>
<p>Với thao tác xây dựng cây phân đoạn, ta thấy rằng, ở mỗi độ sâu của cây, ta sẽ phải duyệt hết toàn bộ phần tử trong dãy để <em>insert</em> vào <em>multiset</em> của các nút cha. 
- <strong>Ví dụ:</strong> Xét trường hợp tổng quát, với <span class="arithmatex">\(N = 8\)</span> là lũy thừa của <span class="arithmatex">\(2\)</span>, ta có cây phân đoạn đầy đủ sau:</p>
<pre><code>![/fptoj_wiki/uploads/segment-tree-basic_img9.png](/fptoj_wiki/uploads/segment-tree-basic_img9.png)

- Ở độ sâu thứ $4$, mỗi nút là nút lá của cây nên ta có thể lấy trực tiếp giá trị từ các phần tử tương ứng trong dãy số. Vì có $N$ nút lá nên ta sẽ mất độ phức tạp $\mathcal{O}(N)$.
- Ở độ sâu thứ $3$, để cập nhật giá trị cho nút quản lí đoạn $[1, 2]$ ta sẽ phải duyệt tất cả các phần tử của cả hai nút con, nghĩa là ta sẽ phải duyệt hết các phần tử trong đoạn $[1, 1]$ và $[2, 2]$. Tương tự với các nút quản lí đoạn $[3, 4]$, $[5, 6]$, $[7, 8]$. Do đó, ta cũng sẽ mất thêm độ phức tạp $\mathcal{O}(N)$.
- Ở độ sâu thứ $2$, để cập nhật giá trị cho nút quản lí đoạn $[1, 4]$ ta sẽ phải duyệt tất cả các phần tử của cả hai nút con, nghĩa là ta sẽ phải duyệt hết các phần tử trong đoạn $[1, 2]$ và $[3, 4]$. Tương tự với nút quản lí đoạn $[5, 8]$. Do đó, ta cũng sẽ mất thêm độ phức tạp $\mathcal{O}(N)$.
- Nhận thấy rằng, với mỗi độ sâu của cây, ta đều phải duyệt lại toàn bộ phần tử trong dãy nên sẽ mất độ phức tạp $\mathcal{O}(N)$.
</code></pre>
<p>Mà chiều cao của cây là <span class="arithmatex">\(\mathcal{O}(\log{N})\)</span> nên thao tác xây dựng cây phân đoạn có độ phức tạp là <span class="arithmatex">\(\mathcal{O}(N \times \log^2{N})\)</span> (độ phức tạp thời gian cho việc chèn, xóa và truy xuất thông tin trên <em>multiset</em> là <span class="arithmatex">\(\mathcal{O}(\log{N})\)</span>).</p>
<p>Với mỗi thao tác cập nhật hoặc lấy giá trị, ta mất độ phức tạp <span class="arithmatex">\(\mathcal{O}(\log^2{N})\)</span>.</p>
<p>Nhìn chung, độ phức tạp của thuật toán là <span class="arithmatex">\(\mathcal{O}(N \times \log^2{N} + M \times \log^2{N})\)</span>.</p>
<h1 id="cap-nhat-luoi-lazy-propagation">Cập nhật lười (Lazy Propagation)</h1>
<p>Đây là kĩ thuật được sử dụng trong <strong>Segment Tree</strong> để giảm độ phức tạp của <strong>Segment Tree</strong> với các truy vấn cập nhật đoạn.</p>
<h2 id="y-tuong_1">Ý tưởng</h2>
<p>Giả sử ta cần cập nhật đoạn <span class="arithmatex">\([u, v]\)</span>. Dễ thấy rằng, việc cập nhật tất cả các nút trên <strong>Segment Tree</strong> sẽ mất độ phức tạp rất lớn là <span class="arithmatex">\(\mathcal{O}(N \times \log{N})\)</span> (do tổng số phần tử nằm trong đoạn <span class="arithmatex">\([u, v]\)</span> có thể lên đến <span class="arithmatex">\(O(N)\)</span>). Do đó, với số lượng truy vấn cập nhật đoạn lớn, thao tác này sẽ không đủ tốt. </p>
<p>Vậy nên, trong quá trình cập nhật, ta chỉ thay đổi giá trị ở các nút gần gốc nhất sao cho tổng tất cả các phạm vi mà các nút đó quản lí đúng bằng đoạn <span class="arithmatex">\([u, v]\)</span>. 
- <strong>Ví dụ:</strong>  Cho mảng <span class="arithmatex">\(<span class="arithmatex">\(A = \{9,2,6,3,1,5,7\}\)</span>\)</span> và ta cần cập nhật đoạn <span class="arithmatex">\([1, 6]\)</span> :</p>
<pre><code>![/fptoj_wiki/uploads/segment-tree-basic_img10.png](/fptoj_wiki/uploads/segment-tree-basic_img10.png)

- Ta chỉ cập nhật giá trị ở các nút quản lý đoạn $[1, 4]$ và $[5, 6]$. Giá trị của các nút quản lý đoạn $[1, 2]$, $[3, 4]$, $[1, 1]$, $[2, 2]$, $[3, 3]$, $[4, 4]$, $[5, 5]$, $[6, 6]$ sẽ không đúng. Ta sẽ chỉ cập nhật lại giá trị của các nút này khi thật sự cần thiết (Do đó kĩ thuật này được gọi là lazy - lười biếng).
</code></pre>
<p>Cụ thể, ta xem xét bài toán sau:</p>
<h2 id="bai-toan_3">Bài toán</h2>
<p><a href="https://oj.vnoi.info/problem/segtree_itlazy">VNOI - ITLAZY</a> </p>
<p>Bạn được cho một mảng gồm <span class="arithmatex">\(n\)</span> số nguyên <span class="arithmatex">\(a_1, a_2, ..., a_n\)</span> <span class="arithmatex">\((|a_i| \le 10^9,\)</span> với <span class="arithmatex">\(1 \le i \le n)\)</span>. Nhiệm vụ của bạn là xử lí <span class="arithmatex">\(2\)</span> loại truy vấn:
- Loại <span class="arithmatex">\(1\)</span> có dạng <span class="arithmatex">\(1 \space x \space y \space val\)</span> : Tăng giá trị của các phần tử từ vị trí thứ <span class="arithmatex">\(x\)</span> đến vị trí thứ <span class="arithmatex">\(y\)</span> trong dãy lên <span class="arithmatex">\(val\)</span> đơn vị <span class="arithmatex">\((1 \le x \le y \le n, 1 \le val \le 10^9)\)</span>.
- Loại <span class="arithmatex">\(2\)</span> có dạng <span class="arithmatex">\(2 \space l \space r\)</span> : In ra phần tử lớn nhất của dãy từ phần tử thứ <span class="arithmatex">\(l\)</span> đến phần tử thứ <span class="arithmatex">\(r\)</span> <span class="arithmatex">\((1 \le l \le r \le n)\)</span>.</p>
<p>Với mỗi truy vấn loại <span class="arithmatex">\(2\)</span>, hãy in ra câu trả lời trên một dòng.</p>
<p><span class="arithmatex">\(\circ \space \space 1 \le n, q \le 10^5\)</span> (với <span class="arithmatex">\(q\)</span> là số lượng truy vấn).</p>
<h2 id="phan-tich_3">Phân tích</h2>
<p>Ban đầu, ta thực hiện thủ tục xây dựng cây phân đoạn như bình thường.</p>
<p>Truy vấn loại <span class="arithmatex">\(2\)</span> là thao tác lấy giá trị cơ bản trên <strong>Segment Tree</strong> đã được phân tích trước đó.</p>
<p>Với truy vấn loại <span class="arithmatex">\(1\)</span>, thao tác cập nhật đoạn <span class="arithmatex">\([u, v]\)</span>. Giả sử ta gọi <span class="arithmatex">\(f[id]\)</span> là giá trị lớn nhất trong đoạn mà nút <span class="arithmatex">\(id\)</span> quản lý. Trong lúc cập nhật, muốn hàm này thực hiện với độ phức tạp không quá <span class="arithmatex">\(O(\log{N})\)</span>, thì khi xét đến <span class="arithmatex">\(1\)</span> nút <span class="arithmatex">\(id\)</span> quản lý đoạn <span class="arithmatex">\([l, r]\)</span> mà đoạn <span class="arithmatex">\([l, r]\)</span> nằm hoàn toàn trong đoạn <span class="arithmatex">\([u, v]\)</span>, thì ta không được đệ quy vào các nút con của nó nữa (nếu không độ phức tạp sẽ là <span class="arithmatex">\(O(N)\)</span> do ta đi vào tất cả các nút nằm trong đoạn <span class="arithmatex">\([u, v]\)</span>). </p>
<p>Để giải quyết, ta dùng kĩ thuật <strong>Lazy Propagation</strong> như sau:
- Mỗi nút của <strong>Segment Tree</strong> sẽ lưu thêm một giá trị <span class="arithmatex">\(lazy[id]\)</span> với ý nghĩa là tất cả các phần tử trong đoạn <span class="arithmatex">\([l, r]\)</span> mà nút <span class="arithmatex">\(id\)</span> quản lý đều được tăng thêm <span class="arithmatex">\(lazy[id]\)</span>. Nói cách khác, nó sẽ lưu trữ các giá trị cần cập nhật của mỗi nút.
- Ban đầu, ta khởi tạo tất cả các phần tử của mảng <span class="arithmatex">\(lazy[]\)</span> bằng <span class="arithmatex">\(0\)</span>. Nếu <span class="arithmatex">\(lazy[id] = 0\)</span> có nghĩa là không có cập nhật nào đang chờ được xử lý trên nút <span class="arithmatex">\(id\)</span> trong cây phân đoạn. Ngược lại, nếu <span class="arithmatex">\(lazy[id] \neq 0\)</span> nghĩa là ta cần cập nhật giá trị của nút <span class="arithmatex">\(id\)</span> theo <span class="arithmatex">\(lazy[id]\)</span> trước khi thực hiện bất kỳ thao tác nào với nút đó <em>(việc cập nhật này tùy vào mục đích của cây; ví dụ như trong bài toán trên, giá trị của nút <span class="arithmatex">\(id\)</span> sẽ được tăng thêm <span class="arithmatex">\(lazy[id]\)</span> )</em>.
- Nếu nút <span class="arithmatex">\(id\)</span> đang xét còn có giá trị được thêm vào chưa xét đến (từ các truy vấn cập nhật xảy ra trước đó, mà chưa được cập nhật hết), ta buộc phải cập nhật nó trước khi lấy giá trị hoặc tiếp tục đệ quy sâu hơn. Sau khi cập nhật xong nút <span class="arithmatex">\(id\)</span>, ta phải đẩy giá trị <span class="arithmatex">\(lazy\)</span> ở nút <span class="arithmatex">\(id\)</span> xuống các con của nó để tiếp tục cập nhật và đặt lại <span class="arithmatex">\(lazy\)</span> của nút <span class="arithmatex">\(id\)</span> về <span class="arithmatex">\(0\)</span>.
- Để làm được điều này, ở đầu các hàm <code>get</code> và <code>update</code> ta thực hiện các thao tác sau:
    - <code>st[id] += lazy[id]</code> - cập nhật giá trị nút <span class="arithmatex">\(id\)</span> theo <span class="arithmatex">\(lazy[id]\)</span>.
    - Nếu nút <span class="arithmatex">\(id\)</span> không phải là nút lá thì ta đẩy giá trị <span class="arithmatex">\(lazy\)</span> xuống các con của nó :
        - <code>lazy[2 * id] += lazy[id]</code>
        - <code>lazy[2 * id + 1] += lazy[id]</code>
    - <code>lazy[id] = 0</code> - chú ý ta cần phải thực hiện thao tác này, nếu không mỗi phần tử của dãy sẽ bị tăng lên nhiều lần, do ta đẩy xuống nhiều lần.
- Bây giờ, để cập nhật đoạn, ta thực hiện tương tự như ở <strong><a href="algo/data-structures/segment-tree-basic">thao tác lấy giá trị</a></strong>, là xác định tập hợp ít nút nhất sao cho tổng tất cả các phạm vi mà các nút đó quản lí đúng bằng đoạn cần cập nhật. Khi đó, ta sửa lại giá trị của các nút thuộc tập hợp này và lưu lại giá trị cần cập nhật vào <span class="arithmatex">\(lazy\)</span> tương ứng với các nút con của chúng.</p>
<h2 id="cai-at_4">Cài đặt</h2>
<p><strong>Cấu trúc dữ liệu:</strong></p>
<ul>
<li>Hằng số <code>inf = 1000000007</code>.</li>
<li>Hằng số <code>maxN = 100007</code>.</li>
<li>Mảng <code>st[]</code> - Lưu thông tin của mỗi nút trên <strong>Segment Tree</strong>.</li>
<li>Mảng <code>lazy[]</code> - Lưu trữ các giá trị cần cập nhật của mỗi nút trên <strong>Segment Tree</strong>.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;bits/stdc++.h&gt;</span>

<span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="p">;</span>

<span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">inf</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mf">1e9</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">7</span><span class="p">;</span>
<span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">maxN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1e5</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">7</span><span class="p">;</span>

<span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">;</span>
<span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="n">maxN</span><span class="p">];</span>
<span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">st</span><span class="p">[</span><span class="mi">4</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">maxN</span><span class="p">],</span><span class="w"> </span><span class="n">lazy</span><span class="p">[</span><span class="mi">4</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">maxN</span><span class="p">];</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">build</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">st</span><span class="p">[</span><span class="n">id</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="n">l</span><span class="p">];</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">mid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="n">build</span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">mid</span><span class="p">);</span>
<span class="w">    </span><span class="n">build</span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">mid</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">);</span>
<span class="w">    </span><span class="n">st</span><span class="p">[</span><span class="n">id</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">st</span><span class="p">[</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">id</span><span class="p">],</span><span class="w"> </span><span class="n">st</span><span class="p">[</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">]);</span>
<span class="p">}</span>

<span class="c1">// Cập nhật nút đang xét và đẩy giá trị lazy xuống các nút con</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">fix</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">lazy</span><span class="p">[</span><span class="n">id</span><span class="p">])</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="n">st</span><span class="p">[</span><span class="n">id</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">lazy</span><span class="p">[</span><span class="n">id</span><span class="p">];</span>

<span class="w">    </span><span class="c1">// Nếu id không phải là nút lá thì đẩy giá trị xuống các nút con</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">r</span><span class="p">){</span>
<span class="w">        </span><span class="n">lazy</span><span class="p">[</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">id</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">lazy</span><span class="p">[</span><span class="n">id</span><span class="p">];</span>
<span class="w">        </span><span class="n">lazy</span><span class="p">[</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">lazy</span><span class="p">[</span><span class="n">id</span><span class="p">];</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">lazy</span><span class="p">[</span><span class="n">id</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">val</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">fix</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">&gt;</span><span class="w">  </span><span class="n">v</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">&lt;</span><span class="w">  </span><span class="n">u</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="cm">/* Khi cài đặt, ta LUÔN ĐẢM BẢO giá trị của nút được cập nhật ĐỒNG THỜI với</span>
<span class="cm">        giá trị Lazy Propagation. Như vậy sẽ tránh sai sót. */</span>
<span class="w">        </span><span class="n">lazy</span><span class="p">[</span><span class="n">id</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">val</span><span class="p">;</span>
<span class="w">        </span><span class="n">fix</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">mid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="n">update</span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">mid</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">val</span><span class="p">);</span>
<span class="w">    </span><span class="n">update</span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">mid</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">val</span><span class="p">);</span>
<span class="w">    </span><span class="n">st</span><span class="p">[</span><span class="n">id</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">st</span><span class="p">[</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">id</span><span class="p">],</span><span class="w"> </span><span class="n">st</span><span class="p">[</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">]);</span>
<span class="p">}</span>

<span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">fix</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">&gt;</span><span class="w">  </span><span class="n">v</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">&lt;</span><span class="w">  </span><span class="n">u</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="o">-</span><span class="n">inf</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">st</span><span class="p">[</span><span class="n">id</span><span class="p">];</span>

<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">mid</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">get1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get</span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">mid</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">);</span>
<span class="w">    </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">get2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get</span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">mid</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">get1</span><span class="p">,</span><span class="w"> </span><span class="n">get2</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">n</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="w">    </span><span class="n">build</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">);</span>

<span class="w">    </span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">q</span><span class="p">;</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">q</span><span class="o">--</span><span class="p">){</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">type</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">val</span><span class="p">;</span>
<span class="w">        </span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">r</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">val</span><span class="p">;</span>
<span class="w">            </span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">val</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">get</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">&#39;\n&#39;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="anh-gia_4">Đánh giá</h2>
<p><strong>Độ phức tạp</strong></p>
<p>Tương tự như thao tác lấy giá trị, độ phức tạp của thao tác <strong>Lazy Propagation</strong> là <span class="arithmatex">\(\mathcal{O}(\log{n})\)</span>. </p>
<p>Nhìn chung, độ phức tạp của cả bài toán là <span class="arithmatex">\(\mathcal{O}(q \times \log{n})\)</span>.</p>
<h1 id="vi-du-4">Ví dụ 4</h1>
<p><a href="https://codeforces.com/problemset/problem/558/E">Codeforces - 558E A Simple Task</a></p>
<h2 id="bai-toan_4">Bài toán</h2>
<p>Cho một chuỗi kí tự <span class="arithmatex">\(S\)</span> độ dài <span class="arithmatex">\(n\)</span> <em>(chỉ chứa các chữ cái tiếng Anh in thường)</em> và <span class="arithmatex">\(q\)</span> truy vấn, mỗi truy vấn có dạng <span class="arithmatex">\(i \space j \space k\)</span> có nghĩa là hãy sắp xếp chuỗi con gồm các kí tự từ <span class="arithmatex">\(i\)</span> đến <span class="arithmatex">\(j\)</span> theo thứ tự không giảm nếu <span class="arithmatex">\(k = 1\)</span> hoặc theo thứ tự không tăng nếu <span class="arithmatex">\(k = 0\)</span>.</p>
<p>In ra chuỗi cuối cùng sau khi đã thực hiện tất cả các truy vấn.</p>
<ul>
<li><span class="arithmatex">\(1 \le n \le 10^5; \space 0 \le q \le 50000\)</span>.</li>
<li><span class="arithmatex">\(1 \le i \le j \le n; \space k \in \{ 0, 1 \}\)</span>.</li>
</ul>
<h2 id="phan-tich_4">Phân tích</h2>
<p>Để giải quyết bài toán, ta sử dụng kĩ thuật <strong><a href="https://en.wikipedia.org/wiki/Counting_sort">sắp xếp đếm phân phối <em>(Counting sort)</em></a></strong>. Vì vậy, đối với mỗi truy vấn, ta sẽ đếm số lần xuất hiện của mỗi ký tự và sau đó cập nhật đoạn như sau:</p>
<div class="highlight"><pre><span></span><code><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">j</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">++</span><span class="n">cnt</span><span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="sc">&#39;a&#39;</span><span class="p">];</span>

<span class="kt">int</span><span class="w"> </span><span class="n">ind</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">25</span><span class="p">);</span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">j</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">ind</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">cnt</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span><span class="w"> </span><span class="n">ind</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">-1</span><span class="p">);</span>
<span class="w">    </span><span class="n">s</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ind</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="sc">&#39;a&#39;</span><span class="p">;</span>
<span class="w">    </span><span class="o">--</span><span class="n">cnt</span><span class="p">[</span><span class="n">ind</span><span class="p">];</span>
<span class="p">}</span>
</code></pre></div>
<p>Tuy nhiên thuật toán trên không đủ tốt đối với số lượng truy vấn lớn. Do đó, ta cần một cấu trúc dữ liệu có thể hỗ trợ các hoạt động trên trong thời gian thích hợp.</p>
<p>Ta sẽ tạo ra <span class="arithmatex">\(26\)</span> mảng tương ứng với mỗi kí tự. Mảng này lưu lại vị trí xuất hiện của từng kí tự trong chuỗi. Và mỗi mảng sẽ được kiểm soát bởi một cây phân đoạn.</p>
<ul>
<li><strong>Ví dụ:</strong> Cho chuỗi <span class="arithmatex">\(S = "dabedaba"\)</span>. Kí tự <span class="arithmatex">\('a'\)</span> sẽ có một cây phân đoạn kiểm soát mảng <span class="arithmatex">\(<span class="arithmatex">\(\{0, 1, 0, 0, 0, 1, 0, 1\}\)</span>\)</span>. Còn kí tự <span class="arithmatex">\('b'\)</span> có một cây phân đoạn kiểm soát mảng <span class="arithmatex">\(<span class="arithmatex">\(\{0, 0, 1, 0, 0, 0, 1, 0\}\)</span>\)</span>, v.v...</li>
</ul>
<p>Với mỗi truy vấn sắp xếp đoạn <span class="arithmatex">\([i, j]\)</span>, ta dùng <strong>Segment Tree</strong> để tính số lần xuất hiện của mỗi ký tự trong đoạn, sau đó sắp xếp chúng và cập nhật mỗi cây phân đoạn với các giá trị mới. 
- <strong>Ví dụ:</strong> Cho chuỗi <span class="arithmatex">\(S = "dabedaba"\)</span>, giả sử ta cần phải sắp xếp các kí tự của chuỗi <span class="arithmatex">\(S\)</span> theo thứ tự <strong>tăng dần</strong>:
    - Gọi <span class="arithmatex">\(cnt[i]\)</span> là số lần xuất hiện của kí tự <span class="arithmatex">\(i\)</span> trong chuỗi <span class="arithmatex">\(S\)</span>. Ta có thể dễ dàng tính toán mảng <span class="arithmatex">\(cnt\)</span> bằng cách lấy giá trị từ các cây phân đoạn tương ứng với mỗi kí tự. 
    - Sau khi lấy giá trị xong, trên cây phân đoạn, ta sẽ cập nhật lại tất cả phần tử của mảng tương ứng với từng kí tự bằng giá trị <span class="arithmatex">\(0\)</span>.
    - Tiếp theo, ta dùng cây phân đoạn để cập nhật mảng tương ứng với kí tự <span class="arithmatex">\('a'\)</span> từ vị trí <span class="arithmatex">\(1\)</span> đến vị trí <span class="arithmatex">\(3\)</span> (do <span class="arithmatex">\(cnt['a'] = 3\)</span>) bằng giá trị <span class="arithmatex">\(1\)</span> . Rồi lại tiếp tục cập nhật mảng tương ứng với kí tự <span class="arithmatex">\('b'\)</span> từ vị trí <span class="arithmatex">\(4\)</span> đến vị trí <span class="arithmatex">\(5\)</span> (do <span class="arithmatex">\(cnt['b'] = 2\)</span>) bằng giá trị <span class="arithmatex">\(1\)</span>. Vì <span class="arithmatex">\(cnt['c'] = 0\)</span> nên ta bỏ qua kí tự <span class="arithmatex">\('c'\)</span>. Và lại tiếp tục với kí tự <span class="arithmatex">\('d'\)</span>, ... đến kí tự <span class="arithmatex">\('z'\)</span>. 
    - Tương tự, để sắp xếp <strong>giảm dần</strong>, ta chỉ cần xét từ kí tự <span class="arithmatex">\('z'\)</span> về kí tự <span class="arithmatex">\('a'\)</span>.</p>
<p>Ta sử dụng kỹ thuật <strong>Lazy Propagation</strong> để cập nhật các đoạn. Khác với ví dụ trên <em>(ở mục <strong>Bài toán</strong> trong phần <strong>Cập nhật lười (Lazy Propagation)</strong>)</em>, khi cập nhật nút <span class="arithmatex">\(id\)</span> quản lí đoạn <span class="arithmatex">\([l, r]\)</span> theo giá trị <span class="arithmatex">\(lazy[id]\)</span> thì giá trị của nút <span class="arithmatex">\(id\)</span> sẽ được tăng thêm <span class="arithmatex">\(lazy[id] \times (r - l + 1)\)</span>. Vì đây là cây phân đoạn lấy tổng, nên khi mỗi phần tử tăng thêm <span class="arithmatex">\(lazy[id]\)</span> thì tổng giá trị của cả đoạn <span class="arithmatex">\([l, r]\)</span> sẽ tăng thêm <span class="arithmatex">\(lazy[id] \times (r - l + 1)\)</span>.</p>
<p>Vì thao tác cập nhật cây phân đoạn này là gán giá trị (<span class="arithmatex">\(0\)</span> hoặc <span class="arithmatex">\(1\)</span>) nên ta sẽ khởi tạo giá trị ban đầu của mảng <span class="arithmatex">\(lazy\)</span> bằng <span class="arithmatex">\(-1\)</span>.</p>
<h2 id="cai-at_5">Cài đặt</h2>
<p><strong>Cấu trúc dữ liệu:</strong></p>
<ul>
<li>Hằng số <code>maxN = 100007</code>.</li>
<li>Mảng <code>cnt[]</code> - Lưu lại số lần xuất hiện của mỗi kí tự.</li>
<li>Mảng <code>st[][]</code> - Lưu thông tin của mỗi nút trên <strong>Segment Tree</strong> tương ứng với mỗi kí tự.</li>
<li>Mảng <code>lazy[][]</code> - Lưu trữ các giá trị cần cập nhật của mỗi nút trên <strong>Segment Tree</strong> tương ứng với mỗi kí tự.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;bits/stdc++.h&gt;</span>

<span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="p">;</span>

<span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">maxN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1e5</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">7</span><span class="p">;</span>

<span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">;</span>
<span class="n">string</span><span class="w"> </span><span class="n">s</span><span class="p">;</span>
<span class="kt">int</span><span class="w"> </span><span class="n">cnt</span><span class="p">[</span><span class="mi">30</span><span class="p">];</span>
<span class="kt">int</span><span class="w"> </span><span class="n">st</span><span class="p">[</span><span class="mi">30</span><span class="p">][</span><span class="mi">4</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">maxN</span><span class="p">],</span><span class="w"> </span><span class="n">lazy</span><span class="p">[</span><span class="mi">30</span><span class="p">][</span><span class="mi">4</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">maxN</span><span class="p">];</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">build</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Khởi tạo giá trị mảng lazy ban đầu bằng -1</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">ch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">ch</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">25</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">ch</span><span class="p">)</span><span class="w"> </span><span class="n">lazy</span><span class="p">[</span><span class="n">ch</span><span class="p">][</span><span class="n">id</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">st</span><span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="n">l</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="sc">&#39;a&#39;</span><span class="p">][</span><span class="n">id</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">mid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="n">build</span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">mid</span><span class="p">);</span>
<span class="w">    </span><span class="n">build</span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">mid</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">);</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">ch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">ch</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">25</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">ch</span><span class="p">)</span>
<span class="w">        </span><span class="n">st</span><span class="p">[</span><span class="n">ch</span><span class="p">][</span><span class="n">id</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">st</span><span class="p">[</span><span class="n">ch</span><span class="p">][</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">id</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">st</span><span class="p">[</span><span class="n">ch</span><span class="p">][</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">fix</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">ch</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lazy</span><span class="p">[</span><span class="n">ch</span><span class="p">][</span><span class="n">id</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="n">st</span><span class="p">[</span><span class="n">ch</span><span class="p">][</span><span class="n">id</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lazy</span><span class="p">[</span><span class="n">ch</span><span class="p">][</span><span class="n">id</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">r</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">r</span><span class="p">){</span>

<span class="w">        </span><span class="cm">/* Vì là thao tác gán giá trị chứ KHÔNG phải là tăng thêm một lượng</span>
<span class="cm">        nên lazy của nút con sẽ gán bằng lazy của nút cha */</span>
<span class="w">        </span><span class="n">lazy</span><span class="p">[</span><span class="n">ch</span><span class="p">][</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">id</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lazy</span><span class="p">[</span><span class="n">ch</span><span class="p">][</span><span class="n">id</span><span class="p">];</span><span class="w"> </span>
<span class="w">        </span><span class="n">lazy</span><span class="p">[</span><span class="n">ch</span><span class="p">][</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lazy</span><span class="p">[</span><span class="n">ch</span><span class="p">][</span><span class="n">id</span><span class="p">];</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">lazy</span><span class="p">[</span><span class="n">ch</span><span class="p">][</span><span class="n">id</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">val</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">ch</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">fix</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">ch</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">&gt;</span><span class="w">  </span><span class="n">v</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">&lt;</span><span class="w">  </span><span class="n">u</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">lazy</span><span class="p">[</span><span class="n">ch</span><span class="p">][</span><span class="n">id</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">val</span><span class="p">;</span>
<span class="w">        </span><span class="n">fix</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">ch</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">mid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="n">update</span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">mid</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">val</span><span class="p">,</span><span class="w"> </span><span class="n">ch</span><span class="p">);</span>
<span class="w">    </span><span class="n">update</span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">mid</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">val</span><span class="p">,</span><span class="w"> </span><span class="n">ch</span><span class="p">);</span>
<span class="w">    </span><span class="n">st</span><span class="p">[</span><span class="n">ch</span><span class="p">][</span><span class="n">id</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">st</span><span class="p">[</span><span class="n">ch</span><span class="p">][</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">id</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">st</span><span class="p">[</span><span class="n">ch</span><span class="p">][</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">ch</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">fix</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">ch</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">&gt;</span><span class="w">  </span><span class="n">v</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">&lt;</span><span class="w">  </span><span class="n">u</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">st</span><span class="p">[</span><span class="n">ch</span><span class="p">][</span><span class="n">id</span><span class="p">];</span>

<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">mid</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">get1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get</span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">mid</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">ch</span><span class="p">);</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">get2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get</span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">mid</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">ch</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">get1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">get2</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">q</span><span class="p">;</span>
<span class="w">    </span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">s</span><span class="p">;</span>
<span class="w">    </span><span class="n">build</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">);</span>

<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">q</span><span class="o">--</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">;</span>
<span class="w">        </span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">k</span><span class="p">;</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">ch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">ch</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">25</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">ch</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">cnt</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="n">ch</span><span class="p">);</span>
<span class="w">            </span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">ch</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">ch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">25</span><span class="p">),</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">ch</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">ch</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">25</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">cnt</span><span class="p">[</span><span class="n">ch</span><span class="p">])</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">cnt</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">ch</span><span class="p">);</span>
<span class="w">                </span><span class="n">l</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">cnt</span><span class="p">[</span><span class="n">ch</span><span class="p">];</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="n">ch</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">-1</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// In ra đáp án</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">ch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">ch</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">25</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">ch</span><span class="p">)</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">ch</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="p">)(</span><span class="n">ch</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="sc">&#39;a&#39;</span><span class="p">);</span>
<span class="w">                </span><span class="k">break</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="anh-gia_5">Đánh giá</h2>
<p><strong>Độ phức tạp</strong></p>
<p>Độ phức tạp của thuật toán là <span class="arithmatex">\(\mathcal{O}(q \times 26 \times \log{n})\)</span>.</p>
<h1 id="vi-du-5">Ví dụ 5</h1>
<p><a href="https://oj.vnoi.info/problem/segtree_itladder">VNOI - ITLADDER</a></p>
<h2 id="bai-toan_5">Bài toán</h2>
<p>Cho một dãy số có <span class="arithmatex">\(N\)</span> số, ban đầu tất cả bằng <span class="arithmatex">\(0\)</span>. Bạn cần xử lí <span class="arithmatex">\(2\)</span> loại truy vấn:
- Truy vấn loại <span class="arithmatex">\(1\)</span> có dạng <span class="arithmatex">\(1 \space L \space R \space A \space B\)</span>, ta cộng thêm vào phần tử thứ <span class="arithmatex">\(i\)</span> thêm <span class="arithmatex">\((i − L)A + B\)</span> đơn vị với mọi <span class="arithmatex">\(L \le i \le R\)</span>.
- Truy vấn loại <span class="arithmatex">\(2\)</span> có dạng <span class="arithmatex">\(2 \space L \space R\)</span>, ta cần in ra tổng của các phần tử trong khoảng <span class="arithmatex">\([L..R]\)</span>, lấy dư cho <span class="arithmatex">\(10^9 + 7\)</span>.</p>
<p><span class="arithmatex">\(\circ \space \space 1 \le N, M \le 10^5\)</span> (với <span class="arithmatex">\(M\)</span> là số lượng truy vấn). Các số trong <em>input</em> đều lớn hơn hoặc bằng <span class="arithmatex">\(1\)</span> và nhỏ hơn hoặc bằng <span class="arithmatex">\(10^9\)</span>.</p>
<h2 id="phan-tich_5">Phân tích</h2>
<ul>
<li>Với truy vấn loại <span class="arithmatex">\(1\)</span>: Ta để ý đến giá trị được cộng vào. Với mọi <span class="arithmatex">\(L \le i \le R\)</span>, ta cộng thêm vào phần tử thứ <span class="arithmatex">\(i\)</span> thêm <span class="arithmatex">\((i − L)A + B = iA + B - LA\)</span> đơn vị. Trong đó <span class="arithmatex">\(B – LA\)</span> là không đổi với mọi phần tử trong truy vấn đề cập đến nên ta có thể dễ dàng sử dụng kĩ thuật <strong>Lazy Propagation</strong> để cập nhật. Còn lại là <span class="arithmatex">\(iA\)</span> đơn vị, giá trị này thay đổi nên phải dùng mảng <span class="arithmatex">\(lazy\)</span> thứ <span class="arithmatex">\(2\)</span> để lưu lại những giá trị dạng này. Nhận thấy rằng, khi mỗi phần tử trong đoạn <span class="arithmatex">\([l, r]\)</span> tăng thêm <span class="arithmatex">\(iA\)</span> đơn vị thì tổng giá trị của cả đoạn <span class="arithmatex">\([l, r]\)</span> sẽ tăng thêm <span class="arithmatex">\(A \times (r + l) \times (r - l + 1) \space / \space 2\)</span>.
    Từ đó, bài toán chuyển về <strong>Segment Tree</strong> bình thường với <span class="arithmatex">\(2\)</span> mảng <span class="arithmatex">\(lazy\)</span>.</li>
<li>Với truy vấn loại <span class="arithmatex">\(2\)</span> : Ta thực hiện thao tác lấy giá trị trên cây phân đoạn. </li>
</ul>
<h2 id="cai-at_6">Cài đặt</h2>
<p><strong>Cấu trúc dữ liệu:</strong></p>
<ul>
<li>Hằng số <code>maxN = 100007</code>.</li>
<li>Mảng <code>st[]</code> - Lưu thông tin của mỗi nút trên <strong>Segment Tree</strong>.</li>
<li>Mảng <code>lazy[]</code> - Lưu trữ các giá trị cần cập nhật của mỗi nút trên <strong>Segment Tree</strong>.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;bits/stdc++.h&gt;</span>

<span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="p">;</span>

<span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">mod</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mf">1e9</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">7</span><span class="p">;</span>
<span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">maxN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1e5</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">7</span><span class="p">;</span>

<span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">;</span>
<span class="kt">int</span><span class="w"> </span><span class="n">st</span><span class="p">[</span><span class="mi">4</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">maxN</span><span class="p">];</span>
<span class="n">pair</span><span class="w"> </span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lazy</span><span class="p">[</span><span class="mi">4</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">maxN</span><span class="p">];</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">fix</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lazy</span><span class="p">[</span><span class="n">id</span><span class="p">].</span><span class="n">first</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lazy</span><span class="p">[</span><span class="n">id</span><span class="p">].</span><span class="n">second</span><span class="p">;</span>
<span class="w">    </span><span class="n">st</span><span class="p">[</span><span class="n">id</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="p">(</span><span class="mf">1l</span><span class="n">l</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">r</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">l</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">r</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">mod</span><span class="p">;</span>
<span class="w">    </span><span class="n">st</span><span class="p">[</span><span class="n">id</span><span class="p">]</span><span class="w"> </span><span class="o">%=</span><span class="w"> </span><span class="n">mod</span><span class="p">;</span>
<span class="w">    </span><span class="n">st</span><span class="p">[</span><span class="n">id</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="p">(</span><span class="mf">1l</span><span class="n">l</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">r</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">mod</span><span class="p">;</span>
<span class="w">    </span><span class="n">st</span><span class="p">[</span><span class="n">id</span><span class="p">]</span><span class="w"> </span><span class="o">%=</span><span class="w"> </span><span class="n">mod</span><span class="p">;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">lazy</span><span class="p">[</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">id</span><span class="p">].</span><span class="n">first</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">lazy</span><span class="p">[</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">id</span><span class="p">].</span><span class="n">first</span><span class="w">  </span><span class="o">+</span><span class="w"> </span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">mod</span><span class="p">;</span>
<span class="w">        </span><span class="n">lazy</span><span class="p">[</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">id</span><span class="p">].</span><span class="n">second</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">lazy</span><span class="p">[</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">id</span><span class="p">].</span><span class="n">second</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">mod</span><span class="p">;</span>
<span class="w">        </span><span class="n">lazy</span><span class="p">[</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">].</span><span class="n">first</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">lazy</span><span class="p">[</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">].</span><span class="n">first</span><span class="w">  </span><span class="o">+</span><span class="w"> </span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">mod</span><span class="p">;</span>
<span class="w">        </span><span class="n">lazy</span><span class="p">[</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">].</span><span class="n">second</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">lazy</span><span class="p">[</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">].</span><span class="n">second</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">mod</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">lazy</span><span class="p">[</span><span class="n">id</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">};</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">fix</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">&gt;</span><span class="w">  </span><span class="n">v</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">&lt;</span><span class="w">  </span><span class="n">u</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">lazy</span><span class="p">[</span><span class="n">id</span><span class="p">].</span><span class="n">first</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">;</span>
<span class="w">        </span><span class="n">lazy</span><span class="p">[</span><span class="n">id</span><span class="p">].</span><span class="n">second</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mf">1l</span><span class="n">l</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1l</span><span class="n">l</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1l</span><span class="n">l</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">mod</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">mod</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">mod</span><span class="p">;</span>
<span class="w">        </span><span class="n">fix</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">mid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="n">update</span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">mid</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">);</span>
<span class="w">    </span><span class="n">update</span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">mid</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">);</span>
<span class="w">    </span><span class="n">st</span><span class="p">[</span><span class="n">id</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">st</span><span class="p">[</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">id</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">st</span><span class="p">[</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">])</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">mod</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">fix</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">&gt;</span><span class="w">  </span><span class="n">v</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">&lt;</span><span class="w">  </span><span class="n">u</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">st</span><span class="p">[</span><span class="n">id</span><span class="p">];</span>

<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">mid</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">get1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get</span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">mid</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">);</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">get2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get</span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">mid</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">get1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">get2</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">mod</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">m</span><span class="p">;</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">m</span><span class="o">--</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">type</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
<span class="w">        </span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">r</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
<span class="w">            </span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">get</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">&#39;\n&#39;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="anh-gia_6">Đánh giá</h2>
<p><strong>Độ phức tạp</strong></p>
<p>Độ phức tạp của thuật toán là <span class="arithmatex">\(\mathcal{O}(M \times \log{N})\)</span>.</p>
<h1 id="bai-tap-ap-dung">Bài tập áp dụng</h1>
<ul>
<li><a href="https://oj.vnoi.info/contest/segtree">VNOI - Educational Segment Tree Contest</a></li>
<li><a href="http://vnspoj.blogspot.com/p/blog-page_96.html">VOJ - Blogspot Segment Tree</a></li>
<li><a href="https://codeforces.com/blog/entry/22616">Codeforces - Segment Tree Problems</a></li>
<li><a href="https://codeforces.com/edu/course/2">Codeforces - ITMO Academy: pilot course</a></li>
<li><a href="https://codeforces.com/problemset/problem/1371/F">Codeforces - 1371F Raging Thunder</a></li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
      
        <script src="../../../js/jquery-3.7.1.min.js"></script>
      
        <script src="../../../js/webjs.js"></script>
      
    
  </body>
</html>